(function(){var i,n,t=function(n,t){return function(){return n.apply(t,arguments)}};ko.validation.init({registerExtenders:!0},!0);i=function(){function n(){this.toggleTab=t(this.toggleTab,this);this.submitFundIn=t(this.submitFundIn,this);this.submitWithdrawalRequest=t(this.submitWithdrawalRequest,this);this.loadProfile=t(this.loadProfile,this);var r,n,i;r={Email:"Email",SMS:"SMS"};n={DoNotNotify:"Do not notify",Email:"Email",SMS:"SMS"};this.shownTab=ko.observable();this.currency=ko.observable("N/A");this.balanceWallet=ko.observable();this.playerBankAccountId=ko.observable("");this.withdrawalAmount=ko.observable("").extend({formatDecimal:2,validatable:!0,required:!0,min:{message:"Entered amount must be greater than 0.",params:.01},max:{message:"Entered amount is bigger than allowed.",params:2147483647}});this.withdrawalNotificationMethods=ko.observableArray(function(){var t=[];for(i in n)t.push(n[i]);return t}());this.withdrawalNotificationMethod=ko.observable(n.DoNotNotify);this.withdrawalRequestInProgress=ko.observable(!1);this.withdrawalRequestSuccess=ko.observable(location.hash==="#withdrawalDetails/success");this.withdrawalRequestErrors=ko.observableArray([]);this.playerName=ko.observable("N/A");this.transferFundType=ko.observable();this.fundInWallet=ko.observable();this.fundInBonusCode=ko.observable();this.walletBalance=ko.observable("");this.fundInWallet.subscribe(function(n){return function(){return $.get("GetProductBalance",{walletId:n.fundInWallet()}).done(function(t){return n.walletBalance(t.main.toFixed(2))})}}(this));this.fundInAmount=ko.observable("").extend({formatDecimal:2,validatable:!0,required:!0,min:{message:"Entered amount must be greater than 0.",params:.01},max:{message:"Entered amount is bigger than allowed.",params:2147483647}});this.fundInRequestInProgress=ko.observable(!1);this.fundInSuccess=ko.observable(~location.hash.indexOf("#fundIn/success"));this.fundInTransferId=ko.observable(location.hash.substr(16));this.fundInErrors=ko.observableArray([]);$.extend(this,new window.OfflineDepositModel);$.extend(this,new window.OnlineDepositModel);$(window).on("hashchange",function(n){return function(){return n.toggleTab()}}(this));setTimeout(function(){return $("[type=number]").val("")})}return n.prototype.IsJsonString=function(n){var t;try{JSON.parse(n)}catch(i){return t=i,!1}return!0},n.prototype.loadProfile=function(){return $.getJson("/api/profile").done(function(n){return function(t){if(t.success)return n.currency(t.profile.currencyCode),n.playerName(""+t.profile.firstName+" "+t.profile.lastName)}}(this))},n.prototype.submitWithdrawalRequest=function(){var n,t,i;if(this.withdrawalRequestSuccess(!1),this.withdrawalRequestErrors([]),!this.withdrawalAmount.isValid()){this.withdrawalRequestErrors.push("Withdrawal failed. "+this.withdrawalAmount.error);return}return this.withdrawalRequestInProgress(!0),n=$("#playerBankAccountId").text(),t=$("#playerBankAccountTime").text(),i=$("#playerBankTime").text(),$.postJson("/api/offlineWithdrawal",{PlayerBankAccountId:n,Amount:this.withdrawalAmount(),NotificationType:this.withdrawalNotificationMethod(),BankTime:i,BankAccountTime:t}).done(function(){return function(){return location.href="#withdrawalDetails/success",location.reload()}}(this)).fail(function(n){return function(t){var r,i,u,e,f;if(i=JSON.parse(t.responseText),IsJsonString(i.message))return r=JSON.parse(i.message),n.withdrawalRequestErrors.push("Withdrawal failed. "+i18n.t(r.text,r.variables));if(i.unexpected)return n.withdrawalRequestErrors.push("Withdrawal failed. Unexpected error occurred.");for(f=i.errors,u=0,e=f.length;u<e;u++)r=f[u],n.withdrawalRequestErrors.push(r);if(i.errors.length===0&&i.message)return n.withdrawalRequestErrors.push("Withdrawal failed. "+i18n.t(i.message))}}(this)).always(function(n){return function(){return n.withdrawalRequestInProgress(!1)}}(this))},n.prototype.submitFundIn=function(){if(this.fundInSuccess(!1),this.fundInErrors([]),!this.fundInAmount.isValid()){this.fundInErrors.push("Withdrawal failed. "+this.fundInAmount.error);return}return this.fundInRequestInProgress(!0),$.postJson("/api/fundIn",{TransferFundType:this.transferFundType(),WalletId:this.fundInWallet(),Amount:this.fundInAmount(),BonusCode:this.fundInBonusCode()}).done(function(){return function(n){return location.href="#fundIn/success/"+n.transferId,location.reload()}}(this)).fail(function(n){return function(t){var f,i,r,e,u;if(i=JSON.parse(t.responseText),i.unexpected)return n.fundInErrors.push("Unexpected error occurred.");for(u=i.errors,r=0,e=u.length;r<e;r++)f=u[r],n.fundInErrors.push(f);if(i.errors.length===0&&i.message)return n.fundInErrors.push("Transfer failed. "+i18n.t(i.message))}}(this)).always(function(n){return function(){return n.fundInRequestInProgress(!1)}}(this))},n.prototype.toggleTab=function(){var n;return n=location.hash.substr(1)||"balance",~n.indexOf("/")&&(n=n.substr(0,n.indexOf("/"))),this.shownTab(n)},n}();n=new i;n.loadProfile();n.toggleTab();n.errors=ko.validation.group(n);ko.applyBindings(n,document.getElementById("balance-information-wrapper"))}).call(this);