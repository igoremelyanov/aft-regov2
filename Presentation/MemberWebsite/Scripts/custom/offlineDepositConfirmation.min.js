(function(){var t,n,i=function(n,t){return function(){return n.apply(t,arguments)}};ko.validation.init({registerExtenders:!0},!0);t=function(){function n(){this.submitOfflineDeposit=i(this.submitOfflineDeposit,this);var n,t;this.self=this;this.uploadControlsInitialized=!1;this.idFrontImage=ko.observable("");this.idBackImage=ko.observable("");this.idReceiptImage=ko.observable("");this.messageClass=ko.observable();this.message=ko.observable();this.submitted=ko.observable(!1);n={SameBank:i18n.t("app:payment.deposit.sameBank"),DifferentBank:i18n.t("app:payment.deposit.differentBank")};this.transferTypes=ko.observableArray(function(){var i=[];for(t in n)i.push(t);return i}());this.transferType=ko.observable(n.SameBank);this.firstName=ko.observable("");this.lastName=ko.observable("");this.verifiedSuccessfully=ko.observable();this.verifiedSuccessfully.subscribe(function(n){return function(t){if(!t&&!n.uploadControlsInitialized)return $("input#upload-front-image-id").ace_file_input(n.makeFileInputSettings(n.idFrontImage)),$("input#upload-back-image-id").ace_file_input(n.makeFileInputSettings(n.idBackImage)),$("input#upload-receipt-image-id").ace_file_input(n.makeFileInputSettings(n.idReceiptImage)),n.uploadControlsInitialized=!0}}(this));this.accountName=ko.observable("");this.referenceCode=ko.observable("").extend({required:!0});this.offlineDeposit=ko.observable("").extend({required:!0});this.bankReferenceNumber=ko.observable("").extend({required:!0});this.isImageLoaded=ko.computed(function(n){return function(){return n.verifiedSuccessfully()?!0:n.idFrontImage()&&n.idBackImage()||n.idReceiptImage()}}(this));this.isImageLoaded.extend({validation:{validator:function(){return function(n){return n}}(this),message:i18n.t("app:payment.deposit.uploadAtLeastOne"),params:!0}});this.amount=ko.observable("").extend({required:!0});this.remarks=ko.observable("").extend({required:!0});this.load()}return n.prototype.verify=function(){return this.verifiedSuccessfully(this.accountName()===this.firstName()||this.accountName()===this.firstName()+" "+this.lastName()||this.accountName()===this.lastName()+" "+this.firstName())},n.prototype.load=function(){return this.id=getParameterByName("id"),$.ajax("/api/GetOfflineDeposit?id="+this.id,{success:function(n){return function(t){return n.referenceCode(t.deposit.referenceCode),n.offlineDeposit(t.deposit.depositType),n.transferType(t.deposit.transferType),n.firstName(t.player.firstName),n.lastName(t.player.lastName),t.deposit.status==="Unverified"?(n.accountName(n.firstName()+" "+n.lastName()),n.amount(0),n.verify()):n.amount(t.deposit.amount)}}(this)})},n.prototype.showError=function(n){var t;return this.isJsonString(n)&&(t=JSON.parse(n),n=i18n.t(t.text,t.variables)),this.message(n),this.messageClass("alert alert-danger")},n.prototype.showSuccessMsg=function(n){var t;return this.isJsonString(n)&&(t=JSON.parse(n),n=i18n.t(t.text,t.variables)),this.message(n),this.messageClass("alert alert-success")},n.prototype.makeFileInputSettings=function(n){return{style:"well",btn_choose:i18n.t("app:payment.deposit.dropImageOrClickToChoose"),no_file:"No File ...",droppable:!0,thumbnail:"fit",before_change:function(t){var i,r;return i=t[0],typeof i=="string"?/\.(jpe?g|png|gif)$/i.test(i)||(n(""),alert(i18n.t("app:payment.deposit.pleaseSelectImage")),-1):(r=$.trim(i.type),(r.length>0&&!/^image\/(jpe?g|png|gif)$/i.test(r)||r.length===0&&!/\.(jpe?g|png|gif)$/i.test(i.name))&&(n(""),alert(i18n.t("app:payment.deposit.pleaseSelectImage")),-1)),!0},before_remove:function(){return n(null),!0}}},n.prototype.submitOfflineDeposit=function(){var i,n,t;return this.isValid()?(i={Id:this.id,PlayerAccountName:this.accountName(),PlayerAccountNumber:null,ReferenceNumber:this.bankReferenceNumber(),TransferType:0,OfflineDepositType:0,Amount:this.amount(),Remark:this.remarks()},t=new XMLHttpRequest,t.onreadystatechange=function(n){return function(i){var r;if(4===t.readyState)return r=JSON.parse(t.responseText),r.result==="failed"?n.showError(r.message):(n.showSuccessMsg("Successfully confirmed."),n.submitted(!0)),$("#upload-front-image-id").data().ace_file_input.disable(),$("#upload-back-image-id").data().ace_file_input.disable(),$("#upload-receipt-image-id").data().ace_file_input.disable(),console.log(["xhr upload complete",i])}}(this),t.open("post","/api/ConfirmOfflineDeposit",!0),n=new FormData,this.verifiedSuccessfully()||(n.append("uploadId1",$("#upload-front-image-id")[0].files[0]),n.append("uploadId2",$("#upload-back-image-id")[0].files[0]),n.append("receiptUpLoad",$("#upload-receipt-image-id")[0].files[0])),n.append("depositConfirm",JSON.stringify(i)),t.send(n)):this.errors.showAllMessages()},n.prototype.isJsonString=function(n){var t;try{JSON.parse(n)}catch(i){return t=i,!1}return!0},n}();n=new t;n.errors=ko.validation.group(n);ko.applyBindings(n,document.getElementById("od-confirmation-wrapper"))}).call(this);