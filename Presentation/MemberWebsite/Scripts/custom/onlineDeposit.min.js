(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}};ko.validation.init({registerExtenders:!0},!0);this.OnlineDepositModel=function(){function t(t,i){this.checkStatus=n(this.checkStatus,this);this.startCheckStatus=n(this.startCheckStatus,this);this.submitOnlineDeposit=n(this.submitOnlineDeposit,this);this.successReturnUrl=t;this.failReturnUrl=i;this.orderId=ko.observable();this.onlineAmount=ko.observable("");this.onlineDepositRequestInProgress=ko.observable(!1);this.checkOnlineDepositInProgress=ko.observable(!1);this.onlineDepositSuccess=ko.observable(location.hash==="#onlineDeposit/success");this.onlineDepositErrors=ko.observableArray([]);this.playerDepositedAmount=ko.observable(0);this.bonusAmount=ko.observable(0);this.totalDepositedAmount=ko.observable(0);this.onlineDepositBonusCode=ko.observable();this.onlineDepositBonusId=ko.observable()}return t.prototype.submitOnlineDeposit=function(){this.onlineDepositSuccess(!1);this.onlineDepositErrors([]);this.onlineDepositRequestInProgress(!0);return $.postJson("/api/onlineDeposit",{Amount:this.onlineAmount(),BonusCode:this.onlineDepositBonusCode(),BonusId:this.onlineDepositBonusId()}).done(function(n){return function(t){var i,r,u,f,e,o,s,h;return n.orderId(t.depositRequestResult.redirectParams.orderId),f=screen.width/1.5,u=screen.height/1.5,s=screen.width/2-f/2,h=screen.height/2-u/2,e="OnlineDeposit",o=getLozalizedPath("/Home/OnlineDepositForm"),n.popupPayWin=window.open(o,e,"height="+u+",width="+f+",left="+s+",top="+h+",location=0"),i=0,r=setInterval(function(){var u;return(i++,n.popupPayWin.isPopwinReady)?(clearInterval(r),u=n.popupPayWin.document,$("#payRedirectForm",u).attr("action",t.depositRequestResult.redirectUrl),$("#method",u).val(t.depositRequestResult.redirectParams.method),$("#channel",u).val(t.depositRequestResult.redirectParams.channel),$("#merchantId",u).val(t.depositRequestResult.redirectParams.merchantId),$("#orderId",u).val(t.depositRequestResult.redirectParams.orderId),$("#amount",u).val(t.depositRequestResult.redirectParams.amount),$("#currency",u).val(t.depositRequestResult.redirectParams.currency),$("#language",u).val(t.depositRequestResult.redirectParams.language),$("#returnUrl",u).val(t.depositRequestResult.redirectParams.returnUrl),$("#notifyUrl",u).val(t.depositRequestResult.redirectParams.notifyUrl),$("#signature",u).val(t.depositRequestResult.redirectParams.signature),$("#payRedirectForm",u).submit(),n.startCheckStatus()):i>=20?clearInterval(r):void 0},300)}}(this)).fail(function(n){return function(t){n.fail(JSON.parse(t.responseText));return n.onlineDepositRequestInProgress(!1)}}(this)).always(function(){return function(){}}(this))},t.prototype.startCheckStatus=function(){var n;return n=setInterval(function(t){return function(){if(t.popupPayWin.closed)return clearInterval(n),t.checkStatus()}}(this),1e3)},t.prototype.fail=function(n){var t,i,r,f,u;if(i="",IsJsonString(n.message)?(t=JSON.parse(n.message),i=i18n.t(t.text,t.variables)):i=i18n.t(n.message),n.unexpected||n.message)return this.onlineDepositErrors.push(i18n.t("app:payment.deposit.depositFailed")+i);for(u=n.errors,r=0,f=u.length;r<f;r++)t=u[r],this.onlineDepositErrors.push(t);if(n.errors.length===0&&n.message)return this.onlineDepositErrors.push(i18n.t("app:payment.deposit.depositFailed")+i)},t.prototype.checkStatus=function(){if(this.checkOnlineDepositInProgress()===!1)return this.checkOnlineDepositInProgress(!0),$.postJson("/api/checkOnlineDepositStatus",{TransactionNumber:this.orderId()}).done(function(n){return function(t){if(t.depositStatus.isPaid){n.onlineDepositSuccess(!0);n.onlineDepositRequestInProgress(!1);return n.playerDepositedAmount(t.depositStatus.amount),n.bonusAmount(t.depositStatus.bonus),n.totalDepositedAmount(t.depositStatus.totalAmount),n.successReturnUrl?redirect(n.successReturnUrl):location.hash="#onlineDepositResult"}n.onlineDepositSuccess(!1);n.onlineDepositRequestInProgress(!1);return n.successReturnUrl?redirect(n.failReturnUrl):location.hash="#onlineDepositResult"}}(this)).fail(function(n){return function(t){return n.fail(JSON.parse(t.responseText))}}(this)).always(function(n){return function(){return n.checkOnlineDepositInProgress(!1)}}(this))},t}()}).call(this);