(function(){var i,t,n=function(n,t){return function(){return n.apply(t,arguments)}};i=function(){function i(){this.isAnyPlaceholderPresent=n(this.isAnyPlaceholderPresent,this);this.updateBalance=n(this.updateBalance,this);this.getBalance=n(this.getBalance,this);this.showStub=n(this.showStub,this);this.showSpinner=n(this.showSpinner,this);this.showCurrencySymbol=n(this.showCurrencySymbol,this);this.showCurrencyCode=n(this.showCurrencyCode,this);this.showBalance=n(this.showBalance,this);this.currentBalance=ko.observable({});this.shouldShowSpinner=ko.observable(!0)}var r,t;return r=0,t={balanceApiUrl:"/api/getbalance",balancePlaceholderSelector:".js-balance-live-view",currencyCodePlaceholderSelector:".js-balance-currency-code",currencySymbolPlaceholderSelector:".js-balance-currency-symbol",spinnerHtml:'<i class="fa fa-spinner fa-spin"><\/i>',stubKey:"app:balanceInformation.balanceNotAvailableStub",defaultBalanceType:"playable",balanceTypeDataAttribute:"balance-type",initialDelay:1e3,maxAttempts:10},i.prototype.showBalance=function(){return this.shouldShowSpinner(!1),$(t.balancePlaceholderSelector).each(function(n){return function(i,r){var f,u,e;return u=$(r),f=(e=u.data(t.balanceTypeDataAttribute))!=null?e:t.defaultBalanceType,u.text(n.currentBalance[f])}}(this))},i.prototype.showCurrencyCode=function(){return $(t.currencyCodePlaceholderSelector).each(function(n){return function(t,i){var r;return r=$(i),r.text(n.currentBalance.currencyCode)}}(this))},i.prototype.showCurrencySymbol=function(){return $(t.currencySymbolPlaceholderSelector).each(function(n){return function(t,i){var r;return r=$(i),r.text(n.currentBalance.currencySymbol)}}(this))},i.prototype.showSpinner=function(){return this.shouldShowSpinner(!0),$(t.balancePlaceholderSelector).html(t.spinnerHtml)},i.prototype.showStub=function(){return this.shouldShowSpinner(!1),$(t.balancePlaceholderSelector).html(i18n.t(t.stubKey))},i.prototype.getBalance=function(n,i){return $.getJson(t.balanceApiUrl).done(function(){return function(t){if(t.success)return n(t.balance)}}(this)).fail(function(){return function(){return i()}}(this))},i.prototype.updateBalance=function(){if(this.isAnyPlaceholderPresent())return this.showSpinner(),this.getBalance(function(n){return function(t){return n.currentBalance=t,n.showBalance(),n.showCurrencyCode(),n.showCurrencySymbol()}}(this),function(n){return function(){var i;return n.showSpinner(),r++,r<t.maxAttempts?(i=t.initialDelay*r,setTimeout(n.updateBalance,i)):n.showStub()}}(this))},i.prototype.isAnyPlaceholderPresent=function(){return $(t.balancePlaceholderSelector).length>0},i}();t=new i;t.showSpinner();t.updateBalance()}).call(this);