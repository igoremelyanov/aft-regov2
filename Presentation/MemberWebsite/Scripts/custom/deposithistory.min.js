(function(){var n,t={}.hasOwnProperty,i=function(n,i){function u(){this.constructor=n}for(var r in i)t.call(i,r)&&(n[r]=i[r]);return u.prototype=i.prototype,n.prototype=new u,n.__super__=i.prototype,n};n=function(n){function r(){r.__super__.constructor.apply(this,arguments);this.depositId=ko.observable();this.depositId.subscribe(function(n){return function(t){return $.get("/api/GetBankAccountForOfflineDeposit?offlineDepositId="+t,function(t){return n.bankAccountIdSettings(t)})}}(this));this.bankAccountIdSettings=ko.observable();this.playerHasValidIdDocuments=ko.observable();this.startdate=ko.observable("");this.enddate=ko.observable("");this.type=ko.observable("");this.transferMethod=ko.observable("");this.transferBank=ko.observable("");this.playerAccountName=ko.observable("");this.playerAccountName.subscribe(function(n){return function(t){return $.blockUI(),$.get("/api/IsDepositorsFullNameValid?name="+t,function(t){return n.isFullNameEqualsPlayersFullName(t),$.unblockUI()})}}(this));this.isFullNameEqualsPlayersFullName=ko.observable(!1);this.isReceiptRequiredPaymentLevelCriteria=ko.computed(function(n){return function(){var t,i,r;return(t=n.bankAccountIdSettings(),r=n.transferMethod(),i=n.transferBank(),t===void 0)?!1:r==="InternetBanking"&&i==="SameBank"?t.internetSameBank:r==="CounterDeposit"&&i==="SameBank"?t.counterDepositSameBank:r==="ATM"&&i==="SameBank"?t.atmSameBank:r==="InternetBanking"&&i==="DifferentBank"?t.internetDifferentBank:r==="CounterDeposit"&&i==="DifferentBank"?t.counterDepositDifferentBank:r==="ATM"&&i==="DifferentBank"?t.atmDifferentBank:void 0}}(this));this.isReceiptRequired=ko.computed(function(n){return function(){return n.playerAccountName()===""||n.playerAccountName()===void 0?!1:n.isReceiptRequiredPaymentLevelCriteria()===!0?!0:n.playerHasValidIdDocuments()===!1?!0:n.isFullNameEqualsPlayersFullName()===!1?!0:!1}}(this));this.isIdRequired=ko.computed(function(n){return function(){return n.playerAccountName()===""||n.playerAccountName()===void 0?!1:n.playerHasValidIdDocuments()===!1?!0:n.isFullNameEqualsPlayersFullName()===!1?!0:!1}}(this));this.depositReceipt=ko.observable("").extend({validation:{validator:function(n){return function(){var t,i;return t=$("input#depositReceipt")[0],i=t?t.files[0]:void 0,i?i.size<=n.maxSize:!0}}(this),message:"Maximum file size is 4Mb."}});this.idFront=ko.observable("").extend({validation:[{validator:function(n){return function(){var t,i;return t=$("input#idFront")[0],i=t?t.files[0]:void 0,i?i.size<=n.maxSize:!0}}(this),message:"Maximum file size is 4Mb."}]});this.idBack=ko.observable("").extend({validation:[{validator:function(n){return function(){var t,i;return t=$("input#idBack")[0],i=t?t.files[0]:void 0,i?i.size<=n.maxSize:!0}}(this),message:"Maximum file size is 4Mb."}]});this.amount=ko.observable();this.remark=ko.observable("");this.maxSize=4194304;$.blockUI();$.get("/api/ArePlayersIdDocumentsValid",function(n){return function(t){return n.playerHasValidIdDocuments(t),$.unblockUI()}}(this));this.submitFilter=function(){return $.postJson("/api/FilterDepositHistory",{start:this.startdate,end:this.enddate,type:this.type}).success(function(n){return function(t){return t.hasError?$.each(t.errors,function(t){var i;return i=n[t],i.error="error message",i.__valid__(!1)}):popupAlert("",""),!1}}(this))};this.selectDepositForConfirm=function(n){return this.depositId(n)};this.submitDepositConfirmation=function(){var n,t;return t=$("#confirm-deposit-history-id").serializeArray(),n={Id:this.depositId(),PlayerAccountName:this.playerAccountName(),PlayerAccountNumber:null,TransferType:this.transferBank(),OfflineDepositType:this.transferMethod(),Amount:this.amount(),Remark:this.remark(),IdFrontImage:this.idFront(),IdBackImage:this.idBack(),ReceiptImage:this.depositReceipt()},$.ajax({url:"/api/ValidateConfirmDepositRequest",type:"post",data:n}).success(function(t){return function(i){var u,r;return i.hasError?$.each(i.errors,function(n){var u,r;return r=t[n],u=i18n.t("apiResponseCodes."+i.errors[n]),r?(r.error=u,r.__valid__(!1),r.isModified(!0)):popupAlert("Error",u)}):(r=new XMLHttpRequest,r.onreadystatechange=function(){if(4===r.readyState)return i=JSON.parse(r.responseText),i.result==="failed"?popupAlert("Error","Error occured. Contact an administrator."):redirect("/Home/DepositHistoryConfirmation?depositId="+t.depositId())},r.open("post","/api/ConfirmOfflineDeposit",!0),u=new FormData,u.append("uploadId1",$("#idFront")[0].files[0]),u.append("uploadId2",$("#idBack")[0].files[0]),u.append("depositConfirm",JSON.stringify(n)),r.send(u))}}(this))};this.triggerInputFile=function(n){return n=$("#"+n),n.parent().hasClass("upload")?n.click():void 0};this.deleteFile=function(n){return $("#"+n).val("").parent().parent().find("img").attr("src","/Content/images/icon_id.png").end().end().end().parent().removeClass("uploaded").addClass("upload").find("button").hide().removeClass("show"),this[n](null),!1}}var t;i(r,n);ko.bindingHandlers.fileUpload={init:function(n,t){return $(n).change(function(){return t()(n.files[0].name),$(n).parent().removeClass("upload").addClass("uploaded").find("button").show().end().find("input").eq(0).blur()})}};$("#deposit-confirmation").one("hidden.bs.modal",function(){return window.location.href=window.location.href});return t=new r,t.errors=ko.validation.group(t),ko.applyBindings(t,document.getElementById("cashier-wrapper")),r}(FormBase)}).call(this);