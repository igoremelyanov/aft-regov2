(function(){var t,n=function(n,t){return function(){return n.apply(t,arguments)}},i={}.hasOwnProperty,r=function(n,t){function u(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n};t=function(t){function i(){this.selectBonus=n(this.selectBonus,this);this.clearError=n(this.clearError,this);this.setError=n(this.setError,this);this.setAmount=n(this.setAmount,this);i.__super__.constructor.apply(this,arguments);this.skipBonusModalId="skipbonus-alert-modal";this.depositRequestInProgress=ko.observable(!1);this.amount=ko.observable("0").extend({required:!0,validatable:!0,mustNotContainLetters:!0,notNegativeAmount:!0,isValidAmount:!0,validation:[{validator:function(){return function(n,t){var i;return i=n.replace(/,/g,""),i>=t()}}(this),message:"Amount must be greater or equals to a minimum deposit of ${0}",params:function(){return function(){return parseFloat($("#deposit-amount-min").val())}}(this)},{validator:function(){return function(n,t){var i;return t()===0?!0:(i=n.replace(/,/g,""),i<=t())}}(this),message:"Amount must be less or equals to a maximum deposit of ${0}",params:function(){return function(){return parseFloat($("#deposit-amount-max").val())}}(this)}]});this.amount.subscribe(function(n){return function(){return n.claimedBonus(void 0)}}(this));$.ajax("/api/GetVisibleDepositQualifiedBonuses",{success:function(n){return function(t){return n.bonuses(t)}}(this)});this.parseAmountString=function(){return function(n){var t;return t=n.replace(/,/g,""),parseFloat(t)}}(this);this.amountEntered=ko.computed(function(n){return function(){var t;return t=n.parseAmountString(n.amount()),t>0}}(this));this.bonuses=ko.observableArray();this.claimedBonus=ko.observable();this.code=ko.observable("").extend({validatable:!0});this.hasErrors=ko.observable(!1);this.depositCaption=ko.computed(function(n){return function(){return n.claimedBonus()?i18n.t("balanceInformation.depositAndGetBonus"):"Deposit"}}(this));this.submitRequest=function(n){return function(){var t;return t=n.claimedBonus()===void 0?null:n.claimedBonus().id,n.bonuses().length>0&&t===null?$("#"+n.skipBonusModalId).modal():n.goAheadWithDeposititng()}}(this);this.createOnlineDepositObject=function(n){return function(t){var i=new OnlineDepositModel("/home/OnlineDepositConfirmation","",function(){return popupAlert("Error occured.","Contact an administrator.")});i.onlineAmount(n.amount());return i.onlineDepositBonusId(t)}}(this);this.submitCode=function(n){return function(){var t;return n.clearError(n.code),t=_.find(n.bonuses(),function(t){return t.code===n.code()}),t!==void 0?(n.claimedBonus(t),n.code("")):$.postJson("/api/ValidateFirstDepositBonus",{depositAmount:n.amount(),bonusCode:n.code()}).done(function(t){var i;if(t.isValid){if(i=_.find(n.bonuses(),function(n){return n.id===t.bonus.id}),i===void 0)return n.bonuses.unshift(t.bonus),n.claimedBonus(t.bonus),n.code("")}else return n.setError(n.code,t.errors[0])}).fail(function(){return popupAlert("Error occured.","Contact an administrator.")})}}(this);this.validate=function(n){return function(t,i,r){return $.postJson(t,i).done(function(){return r()}).fail(function(t){return n.onErrorHandler(t)})}}(this);this.onErrorHandler=function(n){return function(t){var f,i,o,s,r,h,e,u;for(s=JSON.parse(t.responseText),e=s.errors,u=[],r=0,h=e.length;r<h;r++)f=e[r],o=f.fieldName,i=n[o.toLowerCase()],i?(i.error=f.message,u.push(i.__valid__(!1))):u.push(void 0);return u}}(this)}var u;return r(i,t),i.prototype.setAmount=function(n){var t;return t=this.parseAmountString(n),this.amount(t.toString())},i.prototype.setError=function(n,t){return n.error=t,n.__valid__(!1)},i.prototype.clearError=function(n){return n.error="",n.__valid__(!0)},i.prototype.selectBonus=function(n){if(!(this.amount()<n.requiredAmount))return this.claimedBonus()!==n?this.claimedBonus(n):this.claimedBonus(void 0)},i.prototype.skipDepositAndGetBonus=function(){return $("#"+this.skipBonusModalId).modal("hide")},i.prototype.goAheadWithDeposititng=function(){var n;return n={amount:this.amount()},this.validate("/api/validateonlinedepositamount",n,function(n){return function(){var t,i;return t=n.claimedBonus()===void 0?null:n.claimedBonus().id,i=n.createOnlineDepositObject(t),i.submitOnlineDeposit()}}(this))},u=new i,u.errors=ko.validation.group(u),ko.applyBindings(u,document.getElementById("cashier-wrapper")),i}(FormBase)}).call(this);