(function(){var t,n=function(n,t){return function(){return n.apply(t,arguments)}},i={}.hasOwnProperty,r=function(n,t){function u(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n};t=function(t){function i(){this.clearError=n(this.clearError,this);this.setError=n(this.setError,this);this.setAmount=n(this.setAmount,this);this.selectBonus=n(this.selectBonus,this);i.__super__.constructor.apply(this,arguments);this.skipBonusModalId="skipbonus-alert-modal";this.amount=ko.observable("0").extend({required:!0,validatable:!0,mustNotContainLetters:!0,notNegativeAmount:!0,isValidAmount:!0,validation:[{validator:function(n,t){var i;return i=n.replace(/,/g,""),i>=t()},message:"Amount must be greater or equals to a minimum deposit of ${0}",params:function(){return function(){return parseFloat($("#deposit-amount-min").val())}}(this)},{validator:function(n,t){var i;return t()===0?!0:(i=n.replace(/,/g,""),i<=t())},message:"Amount must be less or equals to a maximum deposit of ${0}",params:function(){return function(){return parseFloat($("#deposit-amount-max").val())}}(this)}]});this.amount.subscribe(function(n){return function(){return n.claimedBonus(void 0)}}(this));$.ajax("/api/GetVisibleDepositQualifiedBonuses",{success:function(n){return function(t){return n.bonuses(t)}}(this)});this.parseAmountString=function(){return function(n){var t;return t=n.replace(/,/g,""),parseFloat(t)}}(this);this.amountEntered=ko.computed(function(n){return function(){var t;return t=n.parseAmountString(n.amount()),t>0}}(this));this.bonuses=ko.observableArray();this.claimedBonus=ko.observable();this.depositCaption=ko.computed(function(n){return function(){return n.claimedBonus()?i18n.t("balanceInformation.depositAndGetBonus"):"Deposit"}}(this));this.code=ko.observable("").extend({validatable:!0});this.bank=ko.observable("").extend({validatable:!0});this.remark=ko.observable("").extend({validatable:!0});this.hasErrors=ko.observable(!1);this.smsEnabled=ko.observable(!1);this.emailEnabled=ko.observable(!1);this.notificationMethod=ko.computed(function(n){return function(){return n.smsEnabled()&&n.emailEnabled()?3:n.emailEnabled()?1:n.smsEnabled()?2:0}}(this));this.submitCode=function(n){return function(){var t;return n.clearError(n.code),t=_.find(n.bonuses(),function(t){return t.code===n.code()}),t!==void 0?(n.claimedBonus(t),n.code("")):$.postJson("/api/ValidateFirstDepositBonus",{depositAmount:n.amount(),bonusCode:n.code()}).done(function(t){var i;if(t.isValid){if(i=_.find(n.bonuses(),function(n){return n.id===t.bonus.id}),i===void 0)return n.bonuses.unshift(t.bonus),n.claimedBonus(t.bonus),n.code("")}else return n.setError(n.code,t.errors[0])}).fail(function(){return popupAlert("Error occured.","Contact an administrator.")})}}(this);this.submitDeposit=function(){var n;return n=this.claimedBonus()===void 0?null:this.claimedBonus().id,this.bonuses().length>0&&n===null?$("#"+this.skipBonusModalId).modal():this.goAheadWithDeposititng()}}var u;return r(i,t),i.prototype.selectBonus=function(n){if(!(this.amount()<n.requiredAmount))return this.claimedBonus()!==n?this.claimedBonus(n):this.claimedBonus(void 0)},i.prototype.setAmount=function(n){var t;return t=this.parseAmountString(n),this.amount(t.toString())},i.prototype.setError=function(n,t){return n.error=t,n.__valid__(!1)},i.prototype.clearError=function(n){return n.error="",n.__valid__(!0)},i.prototype.skipDepositAndGetBonus=function(){return $("#"+this.skipBonusModalId).modal("hide")},i.prototype.goAheadWithDeposititng=function(){var n;return n=this.claimedBonus()===void 0?null:this.claimedBonus().id,$.postJson("/api/offlineDeposit",{BankAccountId:this.bank(),Amount:this.amount(),NotificationMethod:this.notificationMethod(),PlayerRemarks:this.remark(),BonusId:n}).done(function(){return function(n){var t;return t="?depositId="+n.id,n.bonusRedemptionId!==void 0&&(t=t+"&redemptionId="+n.bonusRedemptionId),redirect("Home/OfflineDepositConfirmation"+t)}}(this)).fail(function(){return function(){return popupAlert("Error occured.","Contact an administrator.")}}(this))},u=new i,u.errors=ko.validation.group(u),ko.applyBindings(u,document.getElementById("cashier-wrapper")),i}(FormBase)}).call(this);
