(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}};define(["nav","i18next","security/security","dateTimePicker","EntityFormUtil","shell"],function(t,i,r,u,f,e){return function(){function r(){this.save=n(this.save,this);this.getBrandId=n(this.getBrandId,this);this.loadBonuses=n(this.loadBonuses,this);this.loadPaymentMethods=n(this.loadPaymentMethods,this);this.loadFraudRisks=n(this.loadFraudRisks,this);this.loadVipLevels=n(this.loadVipLevels,this);this.loadCurrencies=n(this.loadCurrencies,this);this.loadBrands=n(this.loadBrands,this);this.loadLicensees=n(this.loadLicensees,this);this.fillViewModel=n(this.fillViewModel,this);this.load=n(this.load,this);this.loadConfiguration=n(this.loadConfiguration,this);this.activate=n(this.activate,this);var r,t,u,e,o,s;this.message=ko.observable("");this.messageClass=ko.observable;this.form=new f.Form(this);this.isReadOnly=ko.observable(!1);f.setupLicenseeField2(this);f.setupBrandField2(this);this.dummyObservable=ko.observable();this.operators=ko.observableArray([{text:">",value:0},{text:"<",value:1},{text:">=",value:2},{text:"<=",value:3}]);t=this.form.makeField("currency",ko.observable().extend({required:!0})).hasOptions();t.setSerializer(function(){return t.value()}).setDisplay(ko.computed(function(){return t.value()}));s=this.form.makeField("vipLevels",ko.observableArray([]).extend({validation:[{validator:function(){return function(n){return n.length>0}}(this),message:"Should be at least one"}]})).hasOptions();s.setSerializer(function(){return _.map(s.value(),function(){return function(n){return n.id}}(this))});this.form.makeField("hasAccountAge",ko.observable(!1));this.form.makeField("accountAge",ko.observable(1).extend({formatInt:{allowNegative:!1,allowEmpty:!0},validatable:!0,validation:[{validator:function(n){return function(t){return n.dummyObservable(),!n.fields.hasAccountAge()||t>=1}}(this),message:i.t("app:common.validationMessages.countMustBeGreaterOrEqualsTo",{count:1})}]}));this.form.makeField("accountAgeOperator",ko.observable());this.accountAgeOperatorTitle=ko.computed(function(n){return function(){return n.getOperator(n.fields.accountAgeOperator())}}(this));this.form.makeField("hasDepositCount",ko.observable(!1));this.form.makeField("totalDepositCountOperator",ko.observable());this.totalDepositCountOperatorTitle=ko.computed(function(n){return function(){return n.getOperator(n.fields.totalDepositCountOperator())}}(this));this.form.makeField("totalDepositCountAmount",ko.observable(1).extend({formatInt:{allowNegative:!1,allowEmpty:!0},validatable:!0,validation:[{validator:function(n){return function(t){return n.dummyObservable(),!n.fields.hasDepositCount()||t>=1}}(this),message:i.t("app:common.validationMessages.countMustBeGreaterOrEqualsTo",{count:1})}],max:{params:2147483647,message:i.t("app:common.validationMessages.amountIsBiggerThenAllowed")}}));this.form.makeField("hasPaymentMethodCheck",ko.observable(!1));this.paymentMethodsAssignControl=new f.AssignControl;e=this.form.makeField("paymentMethods",this.paymentMethodsAssignControl.assignedItems.extend({required:{message:"At least one payment method should be selected",onlyIf:ko.computed(function(n){return function(){return n.form.fields.hasPaymentMethodCheck.value()}}(this))}}));e.setSerializer(function(){var n,t,i;for(t=[],i=e.value(),n=0;n<i.length;)t[n]=i[n].id,n++;return t});this.form.makeField("hasWithdrawalCount",ko.observable(!1));this.form.makeField("totalWithdrawalCountOperator",ko.observable());this.totalWithdrawalCountOperatorTitle=ko.computed(function(n){return function(){return n.getOperator(n.fields.totalWithdrawalCountOperator())}}(this));this.form.makeField("totalWithdrawalCountAmount",ko.observable(1).extend({formatInt:{allowNegative:!1,allowEmpty:!0},required:!0,validatable:!0,validation:[{validator:function(n){return function(t){return n.dummyObservable(),!n.fields.hasWithdrawalCount()||t>=1}}(this),message:i.t("app:common.validationMessages.countMustBeGreaterOrEqualsTo",{count:1})}],max:{params:2147483647,message:i.t("app:common.validationMessages.amountIsBiggerThenAllowed")}}));this.form.makeField("hasFraudRiskLevel",ko.observable(!1));this.fraudRiskLevelsAssignControl=new f.AssignControl;o=this.form.makeField("riskLevels",this.fraudRiskLevelsAssignControl.assignedItems.extend({required:{message:"At least one risk level should be selected",onlyIf:ko.computed(function(n){return function(){return n.form.fields.hasFraudRiskLevel.value()}}(this))}}));o.setSerializer(function(){var n,t,i;for(t=[],i=o.value(),n=0;n<i.length;)t[n]=i[n].id,n++;return t});this.form.makeField("hasBonusCheck",ko.observable(!1));this.bonusesAssignControl=new f.AssignControl;r=this.form.makeField("bonuses",this.bonusesAssignControl.assignedItems.extend({required:{message:"At least one bonus should be selected",onlyIf:ko.computed(function(n){return function(){return n.form.fields.hasBonusCheck.value()}}(this))}}));r.setSerializer(function(){var t,n,i;for(i=[],t=r.value(),n=0;n<t.length;)i[n]=t[n].id,n++;return i});this.form.makeField("hasWinLoss",ko.observable(!1));this.form.makeField("winLossOperator",ko.observable());this.winLossOperatorTitle=ko.computed(function(n){return function(){return n.getOperator(n.fields.winLossOperator())}}(this));this.form.makeField("winLossAmount",ko.observable(0).extend({formatInt:{allowNegative:!0,allowEmpty:!0},validatable:!0,validation:[{validator:function(n){return function(t){return n.dummyObservable(),!n.fields.hasWinLoss()||t>=-2147483648}}(this),message:i.t("app:common.validationMessages.amountGreaterOrEquals",{amount:-2147483648})}],min:{params:-2147483648,message:i.t("app:common.validationMessages.amountGreaterOrEquals",{amount:-2147483648})},max:{params:2147483647,message:i.t("app:common.validationMessages.amountIsBiggerThenAllowed")},required:!0}));this.form.makeField("hasWithdrawalAverageChange",ko.observable(!1));this.form.makeField("withdrawalAverageChangeOperator",ko.observable());this.withdrawalAverageChangeOperatorTitle=ko.computed(function(n){return function(){return n.getOperator(n.fields.withdrawalAverageChangeOperator())}}(this));this.form.makeField("withdrawalAverageChangeAmount",ko.observable(0).extend({formatInt:{allowNegative:!0,allowEmpty:!0},required:!0,validation:[{validator:function(n){return function(t){return n.dummyObservable(),!n.fields.hasWithdrawalAverageChange()||t>=-2147483648}}(this),message:i.t("app:common.validationMessages.amountGreaterOrEquals",{amount:-2147483648})}],min:{params:-2147483648,message:i.t("app:common.validationMessages.amountGreaterOrEquals",{amount:"–2147483648"})},max:{params:2147483647,message:i.t("app:common.validationMessages.amountIsBiggerThenAllowed")}}));this.form.makeField("hasWinningsToDepositIncrease",ko.observable(!1));this.form.makeField("winningsToDepositIncreaseOperator",ko.observable());this.winningsToDepositIncreaseOperatorTitle=ko.computed(function(n){return function(){return n.getOperator(n.fields.winningsToDepositIncreaseOperator())}}(this));this.form.makeField("winningsToDepositIncreaseAmount",ko.observable(0).extend({formatInt:{allowNegative:!0,allowEmpty:!0},required:!0,validation:[{validator:function(n){return function(t){return n.dummyObservable(),!n.fields.hasWinningsToDepositIncrease()||t>=-2147483648}}(this),message:i.t("app:common.validationMessages.amountGreaterOrEquals",{amount:-2147483648})}],min:{params:-2147483648,message:i.t("app:common.validationMessages.amountGreaterOrEquals",{amount:"–2147483648"})},max:{params:2147483647,message:i.t("app:common.validationMessages.amountIsBiggerThenAllowed")}}));this.form.makeField("id",ko.observable()).lockValue(!0);u=["licensee","brand","currency","vipLevels","hasAccountAge","accountAge","accountAgeOperator","hasDepositCount","totalDepositCountOperator","totalDepositCountAmount","hasPaymentMethodCheck","paymentMethods","hasWithdrawalCount","totalWithdrawalCountOperator","totalWithdrawalCountAmount","hasFraudRiskLevel","riskLevels","hasBonusCheck","bonuses","hasWinLoss","winLossOperator","winLossAmount","hasWithdrawalAverageChange","withdrawalAverageChangeOperator","withdrawalAverageChangeAmount","hasWinningsToDepositIncrease","winningsToDepositIncreaseOperator","winningsToDepositIncreaseAmount"];f.publishIds(this,"risk-check-",u);f.addCommonMembers(this);this.form.publishIsReadOnly(u);this.getLicenseesUrl=function(){return"Licensee/Licensees?useFilter=true"};this.getBrandsUrl=function(n){return function(){return"Licensee/GetActiveBrands?licensee="+n.form.fields.licensee.value().id}}(this);this.form.fields.licensee.value.subscribe(function(n){return function(){return f.loadBrands2(n.getBrandsUrl,n.form.fields.brand)}}(this));this.form.fields.brand.value.subscribe(function(n){return function(){return $(n.uiElement).parent().hide().prev().show(),$.when(n.loadCurrencies(),n.loadVipLevels(),n.loadFraudRisks(),n.loadBonuses()).done(function(){return $(n.uiElement).parent().show().prev().hide()})}}(this));this.configuration=void 0}var u,o,s,h;return r.prototype.activate=function(n){var t;return t=$.Deferred(),this.fields.id(n?n.id:null),this.submitted(n.editMode===!1),this.fields.id()?this.loadConfiguration(t):this.load(t),t.promise()},r.prototype.loadConfiguration=function(n){return $.ajax("riskprofilecheck/GetById?id="+this.fields.id(),{success:function(t){return function(i){return t.configuration=i,t.fillViewModel(),t.load(n)}}(this)})},r.prototype.load=function(n){return f.loadLicensees2(this.getLicenseesUrl,this.form.fields.licensee,function(t){return function(){return t.loadLicensees(function(){return t.loadBrands(function(){return $.when(t.loadCurrencies(),t.loadVipLevels(),t.loadFraudRisks(),t.loadBonuses(),t.loadPaymentMethods()).done(function(){return n.resolve()})})})}}(this))},r.prototype.fillViewModel=function(){return this.fields.hasAccountAge(this.configuration.hasAccountAge),this.fields.accountAgeOperator(this.configuration.accountAgeOperator),this.fields.accountAge(this.configuration.accountAge),this.fields.hasDepositCount(this.configuration.hasDepositCount),this.fields.totalDepositCountOperator(this.configuration.totalDepositCountOperator),this.fields.totalDepositCountAmount(this.configuration.totalDepositCountAmount),this.fields.hasPaymentMethodCheck(this.configuration.hasPaymentMethodCheck),this.fields.hasWithdrawalCount(this.configuration.hasWithdrawalCount),this.fields.totalWithdrawalCountAmount(this.configuration.totalWithdrawalCountAmount),this.fields.totalWithdrawalCountOperator(this.configuration.totalWithdrawalCountOperator),this.fields.hasFraudRiskLevel(this.configuration.hasFraudRiskLevel),this.fields.hasBonusCheck(this.configuration.hasBonusCheck),this.fields.hasWinLoss(this.configuration.hasWinLoss),this.fields.winLossAmount(this.configuration.winLossAmount),this.fields.winLossOperator(this.configuration.winLossOperator),this.fields.hasWithdrawalAverageChange(this.configuration.hasWithdrawalAverageChange),this.fields.withdrawalAverageChangeOperator(this.configuration.withdrawalAverageChangeOperator),this.fields.withdrawalAverageChangeAmount(this.configuration.withdrawalAverageChangeAmount),this.fields.hasWinningsToDepositIncrease(this.configuration.hasWinningsToDepositIncrease),this.fields.winningsToDepositIncreaseOperator(this.configuration.winningsToDepositIncreaseOperator),this.fields.winningsToDepositIncreaseAmount(this.configuration.winningsToDepositIncreaseAmount)},r.prototype.loadLicensees=function(n){var t,i;return t=f.getBrandLicenseeId(e),i=this.form.fields.licensee.options(),this.configuration&&(t=this.configuration.licensee,this.form.fields.licensee.isSet(!0)),f.selectLicensee2(this.form.fields.licensee,t),f.loadBrands2(this.getBrandsUrl,this.form.fields.brand,function(t){return function(){return t.callCallback(n)}}(this))},r.prototype.loadBrands=function(n){var t;return t=this.configuration?this.configuration.brand:e.brand().id(),f.selectBrand2(this.form.fields.brand,t),this.configuration&&this.form.fields.brand.isSet(!0),this.callCallback(n)},r.prototype.loadCurrencies=function(n){var i,t;return t=$.Deferred(),i=this.getBrandId(),i?$.ajax("autoverification/getcurrencies?brandId="+i).done(function(i){return function(r){return i.form.fields.currency.setOptions(r.currencies),i.configuration&&f.selectOption(i.form.fields.currency,function(n){return n===i.configuration.currency}),t.resolve(),i.callCallback(n)}}(this)):(t.resolve(),this.callCallback(n)),t.promise()},r.prototype.loadVipLevels=function(n){var i,t;return t=$.Deferred(),i=this.getBrandId(),i?$.ajax("RiskProfileCheck/getviplevels?brandId="+i).done(function(i){return function(r){var f,u;return i.form.fields.vipLevels.setOptions(r.vipLevels),f=function(n){var i,t,f,u;for(u=r.vipLevels,t=0,f=u.length;t<f;t++)if(i=u[t],i.id===n)return i},i.configuration&&i.configuration.vipLevels&&(u=_.filter(r.vipLevels,function(n){return _.any(i.configuration.vipLevels,function(t){return n.id===t})}),u.length!==0&&i.form.fields.vipLevels.value(u)),t.resolve(),i.callCallback(n)}}(this)):(t.resolve(),this.callCallback(n)),t.promise()},r.prototype.loadFraudRisks=function(n){var i,t;return t=$.Deferred(),i=this.getBrandId(),i?$.ajax("RiskProfileCheck/getfraudrisklevels?brandId="+i).done(function(i){return function(r){var o,u,f,e,h,s;if(o=[],f=[],i.configuration)for(s=r.riskLevels,e=0,h=s.length;e<h;e++)u=s[e],_.contains(i.configuration.riskLevels,u.id)?o.push(u):f.push(u);else f=r.riskLevels;return i.fraudRiskLevelsAssignControl.assignedItems(o),i.fraudRiskLevelsAssignControl.availableItems(f),t.resolve(),i.callCallback(n)}}(this)):(t.resolve(),this.callCallback(n)),t.promise()},r.prototype.loadPaymentMethods=function(n){var i,t;return t=$.Deferred(),i=this.getBrandId(),i?$.ajax("RiskProfileCheck/GetPaymentMethods").done(function(i){return function(r){var o,u,f,e,h,s;if(o=[],f=[],i.configuration)for(s=r.paymentMethods,e=0,h=s.length;e<h;e++)u=s[e],_.contains(i.configuration.paymentMethods,u.id)?o.push(u):f.push(u);else f=r.paymentMethods;return i.paymentMethodsAssignControl.assignedItems(o),i.paymentMethodsAssignControl.availableItems(f),t.resolve(),i.callCallback(n)}}(this)):(t.resolve(),this.callCallback(n)),t.promise()},r.prototype.loadBonuses=function(n){var i,t;return t=$.Deferred(),i=this.getBrandId(),i?$.ajax("RiskProfileCheck/GetBonuses?brandId="+i).done(function(i){return function(r){var o,u,f,e,h,s;if(o=[],f=[],i.configuration)for(s=r.bonuses,e=0,h=s.length;e<h;e++)u=s[e],_.contains(i.configuration.bonuses,u.id)?o.push(u):f.push(u);else f=r.bonuses;return i.bonusesAssignControl.assignedItems(o),i.bonusesAssignControl.availableItems(f),t.resolve(),i.callCallback(n)}}(this)):(t.resolve(),this.callCallback(n)),t.promise()},r.prototype.getBrandId=function(){var n;return n=this.form.fields.brand.value(),n?n.id:null},r.prototype.getOperator=function(n){return n===0?">":n===1?"<":n===2?">=":n===3?"<=":void 0},s={gridBodyId:"risk-profile-check-list",editUrl:"riskProfileCheck/AddOrUpdate"},f.addCommonEditFunctions(r.prototype,s),r.prototype.callCallback=function(n){if(n)return n()},r.prototype.serializeForm=function(){var n;return n=this.form.getDataObject(),JSON.stringify(n)},h=r.prototype.save,r.prototype.save=function(){var n;return n=!1,this.dummyObservable(new Date),n?void 0:h.call(this)},o=r.prototype.handleSaveSuccess,r.prototype.handleSaveSuccess=function(n){return n.data=i.t("app:fraud.riskProfileCheck.messages."+n.data.code),o.call(this,n),t.title(i.t("app:fraud.riskProfileCheck.titles.view"))},u=r.prototype.handleSaveFailure,r.prototype.handleSaveFailure=function(n){return n.data=n.data,u.call(this,n),t.title(i.t("app:fraud.riskProfileCheck.titles.failure"))},r}()})}).call(this);