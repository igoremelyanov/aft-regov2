(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}};define(["nav","i18next","security/security","dateTimePicker","EntityFormUtil","shell"],function(t,i,r,u,f){return function(){function r(){this.loadSystemActions=n(this.loadSystemActions,this);this.loadFraudRisks=n(this.loadFraudRisks,this);this.loadConfiguration=n(this.loadConfiguration,this);this.activate=n(this.activate,this);var i,r,t;this.message=ko.observable("");this.messageClass=ko.observable();this.form=new f.Form(this);this.isReadOnly=ko.observable(!1);this.configuration=ko.observable();this.form.makeField("id",ko.observable()).lockValue(!0);this.form.makeField("fraudTypeName",ko.observable().extend({required:!0,maxLength:50}));this.form.makeField("remarks",ko.observable().extend({required:!0,maxLength:200}));t=this.form.makeField("systemAction",ko.observable().extend({required:!0})).hasOptions();t.setSerializer(function(){return t.value().value});t.setDisplay(ko.computed(function(){var n;if((n=t.value())!=null)return n.name}));this.fraudRiskLevelsAssignControl=new f.AssignControl;r=this.form.makeField("riskLevels",this.fraudRiskLevelsAssignControl.assignedItems);r.setSerializer(function(){var n,t,i;for(t=[],i=r.value(),n=0;n<i.length;)t[n]=i[n].id,n++;return t});i=["riskLevels","fraudTypeName","systemAction","remarks"];f.publishIds(this,"signup-fraud-type-",i);f.addCommonMembers(this);this.form.publishIsReadOnly(i)}var u,e,o;return r.prototype.activate=function(n){var t;return t=$.Deferred(),this.fields.id(n?n.id:null),this.submitted(n.editMode===!1),this.fields.id()?this.loadConfiguration(function(n){return function(){return n.loadFraudRisks(function(){return n.loadSystemActions(function(){return t.resolve()})})}}(this)):this.loadSystemActions(function(n){return function(){return n.loadFraudRisks(function(){return t.resolve()})}}(this)),t.promise()},r.prototype.loadConfiguration=function(n){var t;return t=$.Deferred(),$.ajax("SignUpFraudTypes/GetById?id="+this.fields.id()).done(function(i){return function(r){return i.fields.systemAction(r.systemAction),i.fields.fraudTypeName(r.fraudTypeName),i.fields.remarks(r.remarks),i.configuration(r),t.resolve(),i.callCallback(n)}}(this))},r.prototype.loadFraudRisks=function(n){var t;return t=$.Deferred(),$.ajax("SignUpFraudTypes/GetFraudRiskLevels").done(function(i){return function(r){var o,u,f,e,h,s;if(o=[],f=[],i.configuration())for(s=r.riskLevels,e=0,h=s.length;e<h;e++)u=s[e],_.contains(i.configuration().riskLevels,u.id)?o.push(u):f.push(u);else f=r.riskLevels;return i.fraudRiskLevelsAssignControl.assignedItems(o),i.fraudRiskLevelsAssignControl.availableItems(f),t.resolve(),i.callCallback(n)}}(this)),t.promise()},r.prototype.loadSystemActions=function(n){var t;return t=$.Deferred(),$.ajax("SignUpFraudTypes/GetSystemActions").done(function(i){return function(r){var u;return i.form.fields.systemAction.setOptions(r.systemActions),i.configuration()&&(u=_.findLast(r.systemActions,function(n){return n.value===i.configuration().systemAction}),i.form.fields.systemAction.value(u)),t.resolve(),i.callCallback(n)}}(this)),t.promise()},r.prototype.callCallback=function(n){if(n)return n()},o={gridBodyId:"signup-fraud-types-list",editUrl:"SignUpFraudTypes/AddOrUpdate"},f.addCommonEditFunctions(r.prototype,o),r.prototype.callCallback=function(n){if(n)return n()},r.prototype.serializeForm=function(){var n;return n=this.form.getDataObject(),JSON.stringify(n)},e=r.prototype.handleSaveSuccess,r.prototype.handleSaveSuccess=function(n){return n.data=i.t("app:fraud.signUpFraudType.messages."+n.data.code),e.call(this,n),t.title(i.t("app:fraud.signUpFraudType.titles.view"))},u=r.prototype.handleSaveFailure,r.prototype.handleSaveFailure=function(n){return n.data=i.t("app:fraud.signUpFraudType.messages."+n.data.code),u.call(this,n),t.title(i.t("app:fraud.signUpFraudType.titles.failure"))},r}()})}).call(this);