(function(){define(function(n){var r,t,i,u,f,e;return e=n("durandal/system"),u=n("logger"),f=n("layout/shell/main-menu"),i=n("i18next"),t=n("config"),n("binders/visibleAnimated"),r=function(){function r(){this.security=n("security/security");this.nav=n("nav");this.allLicensees=ko.observableArray();this.selectedLicensees=ko.observableArray();this.delayedSelectedLicensees=ko.computed(function(n){return function(){return n.selectedLicensees()}}(this)).extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}});this.delayedSelectedLicensees.subscribe(function(n){return function(i){var r;if(n.allLicensees().length!==0)return r=ko.utils.arrayMap(i,function(n){return n.id()}),$.ajax({type:"POST",url:t.adminApi("AdminManager/SaveLicenseeFilterSelection"),dataType:"json",data:JSON.stringify({licensees:r}),contentType:"application/json"}).done(function(t){if(t.result==="success")return n.selectedLicenseesIds(r)})}}(this));this.selectedLicenseesIds=ko.observable();this.allBrands=ko.observableArray();this.selectedBrands=ko.observableArray();this.delayedSelectedBrands=ko.computed(function(n){return function(){return n.selectedBrands()}}(this)).extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}});this.delayedSelectedBrands.subscribe(function(n){return function(i){var r;if(n.allBrands().length!==0)return r=ko.utils.arrayMap(i,function(n){return n.id()}),$.ajax({type:"POST",url:t.adminApi("AdminManager/SaveBrandFilterSelection"),dataType:"json",data:JSON.stringify({brands:r}),contentType:"application/json"}).done(function(t){if(t.result==="success")return n.selectedBrandsIds(r)})}}(this));this.selectedBrandsIds=ko.observable();this.licensees=ko.computed(function(n){return function(){var t;return t=n.allLicensees().slice(),(t.length===0||t[0].id()!==null)&&t.unshift({id:ko.observable(null),name:ko.observable(i.t("app:common.allLicensees"))}),t}}(this));this.licensee=ko.computed(function(n){return function(){return n.selectedLicensees().length>0?n.selectedLicensees()[0]:null}}(this));this.brands=ko.computed(function(n){return function(){var t;return t=n.allBrands().slice(),(t.length===0||t[0].id()!==null)&&t.unshift({id:ko.observable(null),name:ko.observable(i.t("app:common.allBrands")),currencies:ko.observableArray([]),vipLevels:ko.observableArray([]),licenseeId:ko.observable(null)}),t}}(this));this.brand=ko.computed(function(n){return function(){return n.brands().length>0?n.brands()[0]:null}}(this));this.brandValue=ko.computed(function(n){return function(){return n.brand()?n.brand().id():null}}(this));this.tabViewCurrentLicenseeId=ko.observable();this.tabViewIsAllSelected=ko.computed(function(n){return function(){return n.allLicensees().length===n.selectedLicensees().length&&n.allBrands().length===n.selectedBrands().length}}(this));this.tabViewChangeCurrentLicensee=function(n){return function(t){return n.tabViewCurrentLicenseeId(t.id())}}(this);this.tabViewActiveCurrentLicenseeBrandNumbers=ko.computed(function(n){return function(){var i,u,t,f,r;for(i=0,r=n.selectedBrands(),t=0,f=r.length;t<f;t++)u=r[t],u.licenseeId()===n.tabViewCurrentLicenseeId()&&i++;return i}}(this));this.tabViewNavPosition=ko.observable(1);this.tabViewNavCheckPrev=function(n){return function(){return n.tabViewNavPosition()===1?!0:!1}}(this);this.tabViewNavCheckNext=function(n){return function(){return n.allLicensees().length<5||n.allLicensees().length-n.tabViewNavPosition()<4?!0:!1}}(this);this.tabViewIsShown=ko.observable(!1);this.tabViewToggle=function(n){return function(){return n.tabViewIsShown(!n.tabViewIsShown())}}(this);this.tabViewToggleLicensee=function(n){return function(t,i){var r,u,e,f;for(n.tabViewCurrentLicenseeId(t.id()),f=n.allBrands(),u=0,e=f.length;u<e;u++)r=f[u],r.licenseeId()===t.id()&&(i.target.checked?n.selectedBrands.push(r):n.selectedBrands.remove(r));return!0}}(this);this.tabViewGetLicenseeInputFields=function(){return function(n){var t;return(t=$("input[data-tabview-licensee-id]"),n!=null)?(t=$.grep(t,function(t){return $(t).attr("data-tabview-licensee-id")===n}),$(t)):t}}(this);this.tabViewToggleBrand=function(n){return function(t){var i,r,f,e,u;return r=ko.utils.arrayFirst(n.allLicensees(),function(n){return n.id()===t.licenseeId()}),f=ko.utils.arrayFilter(n.allBrands(),function(n){return n.licenseeId()===t.licenseeId()}),u=ko.utils.arrayFilter(n.selectedBrands(),function(n){return n.licenseeId()===t.licenseeId()}),i=n.tabViewGetLicenseeInputFields(t.licenseeId()),u.length===0?(n.selectedLicensees.remove(r),i.prop("indeterminate",!1)):(u.length!==f.length?i.prop("indeterminate",!0):i.prop("indeterminate",!1),e=ko.utils.arrayFirst(n.selectedLicensees(),function(n){return n.id()===t.licenseeId()}),e===null&&n.selectedLicensees.push(r)),!0}}(this);this.tabViewAllRemove=function(n){return function(){return n.selectedLicensees.removeAll(),n.selectedBrands.removeAll(),n.tabViewGetLicenseeInputFields().prop("indeterminate",!1)}}(this);this.tabViewAllSelect=function(n){return function(){var t,i,r,e,o,u,f;for(n.selectedLicensees.removeAll(),n.selectedBrands.removeAll(),u=n.allLicensees(),i=0,e=u.length;i<e;i++)t=u[i],n.selectedLicensees.push(t);for(f=n.allBrands(),r=0,o=f.length;r<o;r++)t=f[r],n.selectedBrands.push(t);return n.tabViewGetLicenseeInputFields().prop("indeterminate",!1),!0}}(this)}return r.prototype.tabViewNavPrev=function(){var n;return n=this.tabViewNavPosition(),this.tabViewNavPosition(n-1),$("#licenseeSelector").css("margin-top","+=41px")},r.prototype.tabViewNavNext=function(){var n;return n=this.tabViewNavPosition(),this.tabViewNavPosition(n+1),$("#licenseeSelector").css("margin-top","-=41px")},r.prototype.getLicensees=function(){var n;return n=$.Deferred(),$.get("licensee/GetLicensees",function(){return function(t){return n.resolve(t.licensees)}}(this)),n.promise()},r.prototype.loadLicensees=function(n){return ko.mapping.fromJS({allLicensees:n},{},this)},r.prototype.getBrands=function(){var n;return n=$.Deferred(),$.ajax({type:"GET",url:t.adminApi("Brand/GetUserBrands")}).done(function(){return function(t){return n.resolve(t.brands)}}(this)),n.promise()},r.prototype.loadBrands=function(n){var i,r,t,f,u;for(ko.mapping.fromJS({allBrands:n},{},this),r=ko.utils.arrayFilter(this.allBrands(),function(n){return n.isSelectedInFilter()===!0}),u=[],t=0,f=r.length;t<f;t++)i=r[t],this.selectedBrands.push(i),u.push(this.tabViewToggleBrand(i));return u},r.prototype.selectLicenseesWithoutBrands=function(n){var r,f,e,u,t,o,i;for(u=ko.utils.arrayFilter(n,function(n){return n.isSelectedInFilter===!0}),i=[],t=0,o=u.length;t<o;t++)r=u[t],e=ko.utils.arrayFirst(this.selectedLicensees(),function(n){return n.id()===r.id}),e===null?(f=ko.utils.arrayFirst(this.allLicensees(),function(n){return n.id()===r.id}),i.push(this.selectedLicensees.push(f))):i.push(void 0);return i},r.prototype.selectDefaultLicenseeView=function(){var n;return n=this.selectedBrands().length>0?this.selectedBrands()[0].licenseeId():this.selectedLicensees().length>0?this.selectedLicensees()[0].id():this.allLicensees()[0].id(),this.tabViewCurrentLicenseeId(n)},r.prototype.reloadData=function(){return this.getLicensees().then(function(n){return function(t){return n.allLicensees.removeAll(),n.selectedLicensees.removeAll(),n.tabViewGetLicenseeInputFields().prop("indeterminate",!1),n.loadLicensees(t),n.getBrands().then(function(i){return n.allBrands.removeAll(),n.selectedBrands.removeAll(),n.loadBrands(i),n.selectLicenseesWithoutBrands(t)})}}(this))},r.prototype.activate=function(){var n;return n=$.Deferred(),this.security.activate().then(function(t){return function(){return t.nav.activate(),n.resolve()}}(this)),n.promise()},r.prototype.compositionComplete=function(){var n;this.nav.compositionComplete();this.getLicensees().then(function(n){return function(t){return n.loadLicensees(t),n.getBrands().then(function(i){return n.loadBrands(i),n.selectLicenseesWithoutBrands(t),n.selectDefaultLicenseeView()})}}(this));try{ace.settings.check("navbar","fixed")}catch(t){n=t}try{ace.settings.check("main-container","fixed")}catch(t){n=t}return ko.validation.init({messagesOnModified:!1,insertMessages:!1}),this.isAceLoaded||(console.log("Loading Ace."),$("head").append('<script src="/scripts/ace-elements.min.js"><\/script>').append('<script src="/scripts/ace.js"><\/script>'),this.isAceLoaded=!0),$("#initial-loader").remove()},r}(),new r})}).call(this);