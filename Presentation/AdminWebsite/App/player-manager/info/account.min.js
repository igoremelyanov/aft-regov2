(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}};define(["i18next","player-manager/send-new-password-dialog","security/security","player-manager/change-vip-level-dialog","player-manager/change-payment-level-dialog","config"],function(t,i,r,u,f,e){return function(){function o(){this.cancelExclusion=n(this.cancelExclusion,this);this.unlock=n(this.unlock,this);this.changeFreezeStatus=n(this.changeFreezeStatus,this);var i;i=this;this.firstName=ko.observable().extend({required:!0,minLength:1,maxLength:50}).extend({pattern:{message:"Invalid First Name",params:"^[A-Za-z0-9]+(?:[ .'-][A-Za-z0-9]+)*$"}});this.lastName=ko.observable().extend({required:!0,minLength:1,maxLength:20}).extend({pattern:{message:"Invalid Last Name",params:"^[A-Za-z0-9]+(?:[ ._'-][A-Za-z0-9]+)*$"}});this.dateOfBirth=ko.observable().extend({required:!0});this.title=ko.observable();this.titles=ko.observable();this.gender=ko.observable();this.genders=ko.observable();this.email=ko.observable().extend({required:!0,email:!0,minLength:1,maxLength:50});this.phoneNumber=ko.observable().extend({required:!0,number:!0,minLength:8,maxLength:15});this.mailingAddressLine1=ko.observable().extend({required:!0,minLength:1,maxLength:50});this.mailingAddressLine2=ko.observable().extend({maxLength:50});this.mailingAddressLine3=ko.observable().extend({maxLength:50});this.mailingAddressLine4=ko.observable().extend({maxLength:50});this.mailingAddressCity=ko.observable();this.mailingAddressPostalCode=ko.observable().extend({required:!0,minLength:1,maxLength:10});this.mailingAddressStateProvince=ko.observable().extend({required:!0,minLength:1,maxLength:20});this.physicalAddressLine1=ko.observable().extend({required:!0,minLength:1,maxLength:50});this.physicalAddressLine2=ko.observable().extend({maxLength:50});this.physicalAddressLine3=ko.observable().extend({maxLength:50});this.physicalAddressLine4=ko.observable().extend({maxLength:50});this.physicalAddressCity=ko.observable();this.physicalAddressPostalCode=ko.observable().extend({required:!0,minLength:1,maxLength:10});this.physicalAddressStateProvince=ko.observable();this.securityQuestion=ko.observable();this.securityAnswer=ko.observable();this.country=ko.observable();this.countryName=ko.computed(function(){var n;return n=i.country(),n?n.name():null});this.countries=ko.observableArray();this.contactPreference=ko.observable();this.contactMethods=ko.observable();this.accountAlertEmail=ko.observable(!1);this.accountAlertSms=ko.observable(!1);this.accountAlertsText=ko.computed(function(n){return function(){var t;return t=[],n.accountAlertEmail()&&t.push("Email"),n.accountAlertSms()&&t.push("Sms"),t.length>0?t.join(", "):"None"}}(this)).extend({validation:{validator:function(n){return function(){return n.accountAlertEmail()||n.accountAlertSms()}}(this),message:t.t("app:playerManager.error.accountAlertsEmpty"),params:!0}});this.marketingAlertEmail=ko.observable();this.marketingAlertSms=ko.observable();this.marketingAlertPhone=ko.observable();this.marketingAlertsText=ko.computed(function(n){return function(){var t;return t=[],n.marketingAlertEmail()&&t.push("Email"),n.marketingAlertSms()&&t.push("Sms"),n.marketingAlertPhone()&&t.push("Phone"),t.length>0?t.join(", "):"None"}}(this)).extend({validation:{validator:function(n){return function(){return n.marketingAlertEmail()||n.marketingAlertSms()||n.marketingAlertPhone()}}(this),message:t.t("app:playerManager.error.accountAlertsEmpty"),params:!0}});this.paymentLevel=ko.observable();this.paymentLevels=ko.observableArray();this.paymentLevelName=ko.computed(function(){var n;return n=i.paymentLevel(),n?n.name():null});this.registrationDate=ko.observable();this.licensee=ko.observable();this.brand=ko.observable();this.currency=ko.observable();this.culture=ko.observable();this.vipLevel=ko.observable();this.vipLevels=ko.observableArray();this.vipLevelCode=ko.computed(function(){var n;return n=i.vipLevel(),n?n.code():null});this.vipLevelName=ko.computed(function(){var n;return n=i.vipLevel(),n?n.name():null});this.playerId=ko.observable();this.detailsEditMode=ko.observable(!1);this.fullName=ko.observable();this.username=ko.observable();this.frozen=ko.observable();this.freezeButtonText=ko.computed(function(n){return function(){return n.frozen()===!0?"Unfreeze":"Freeze"}}(this));this.isLocked=ko.observable();this.isInactive=ko.observable();this.isSelfExcluded=ko.observable();this.isTimedOut=ko.observable();this.isEditBtnVisible=ko.computed(function(){return r.isOperationAllowed(r.permissions.update,r.categories.playerManager)});this.isSetStatusBtnVisible=ko.computed(function(){var n;return n=!i.isInactive(),!n&&r.isOperationAllowed(r.permissions.activate,r.categories.playerManager)||n&&r.isOperationAllowed(r.permissions.deactivate,r.categories.playerManager)});this.activateButtonText=ko.computed(function(){return i.isInactive()?"Activate":"Deactivate"},this);this.unexcludeButtonText=ko.computed(function(){return i.isSelfExcluded()?"Cancel exclusion":i.isTimedOut()?"Cancel time out":void 0},this);this.canAssignVipLevel=ko.computed(function(){return r.isOperationAllowed(r.permissions.assignVipLevel,r.categories.playerManager)});this.canAssignPaymentLevel=ko.computed(function(){return r.isOperationAllowed(r.permissions.assignPaymentLevel,r.categories.playerManager)});this.initialData={}}return o.prototype.activate=function(n){var t;return t=this,this.playerId(n.playerId),$.get(e.adminApi("PlayerInfo/Get"),{id:this.playerId()}).done(function(n){return t.brandId=n.brandId,t.frozen(n.frozen),t.isLocked(n.isLocked),t.isInactive(n.isInactive),t.isSelfExcluded(n.isSelfExcluded),t.isTimedOut(n.isTimedOut),ko.mapping.fromJS(n,{},t.initialData),t.registrationDate(n.dateRegistered),t.licensee(n.licensee),t.brand(n.brand),t.currency(n.currencyCode),t.culture(n.culture),$.ajax(e.adminApi("PlayerManager/GetAddPlayerData")).done(function(n){return ko.mapping.fromJS(n.data,{},t)}),$.ajax(e.adminApi("Brand/GetCountries"),{async:!1,data:{brandId:t.brandId},success:function(n){var i;return ko.mapping.fromJS(n,{},t),i=t.countries(),$.each(i,function(n,i){if(i.code()===t.initialData.countryCode())return t.initialData.country=ko.observable(i)})}}),$.ajax(e.adminApi("PlayerManager/GetVipLevels?brandId="+t.brandId),{async:!1,success:function(n){var i;return ko.mapping.fromJS(n,{},t),i=ko.utils.arrayFirst(t.vipLevels(),function(n){return n.id()===t.initialData.vipLevel()}),t.vipLevel(i)}}),$.ajax(e.adminApi("PlayerInfo/GetPlayerTitle?id="+t.playerId())).done(function(n){return t.fullName(n.firstName+" "+n.lastName),t.username(n.username)}),$.ajax(e.adminApi("PlayerManager/GetPaymentLevels?brandId="+t.brandId+"&currency="+t.currency()),{success:function(n){var i;return ko.mapping.fromJS(n,{},t),i=ko.utils.arrayFirst(t.paymentLevels(),function(n){return n.id()===t.initialData.paymentLevel()}),t.paymentLevel(i),t.setForm()}})})},o.prototype.setForm=function(){return this.firstName(this.initialData.firstName()),this.lastName(this.initialData.lastName()),this.dateOfBirth(this.initialData.dateOfBirth()),this.title(this.initialData.title()),this.gender(this.initialData.gender()),this.email(this.initialData.email()),this.phoneNumber(this.initialData.phoneNumber()),this.mailingAddressLine1(this.initialData.mailingAddressLine1()),this.mailingAddressLine2(this.initialData.mailingAddressLine2()),this.mailingAddressLine3(this.initialData.mailingAddressLine3()),this.mailingAddressLine4(this.initialData.mailingAddressLine4()),this.mailingAddressCity(this.initialData.mailingAddressCity()),this.mailingAddressPostalCode(this.initialData.mailingAddressPostalCode()),this.mailingAddressStateProvince(this.initialData.mailingAddressStateProvince()),this.physicalAddressLine1(this.initialData.physicalAddressLine1()),this.physicalAddressLine2(this.initialData.physicalAddressLine2()),this.physicalAddressLine3(this.initialData.physicalAddressLine3()),this.physicalAddressLine4(this.initialData.physicalAddressLine4()),this.physicalAddressCity(this.initialData.physicalAddressCity()),this.physicalAddressPostalCode(this.initialData.physicalAddressPostalCode()),this.physicalAddressStateProvince(this.initialData.physicalAddressStateProvince()),this.country(this.initialData.country()),this.contactPreference(this.initialData.contactPreference()),this.accountAlertSms(this.initialData.accountAlertSms()),this.accountAlertEmail(this.initialData.accountAlertEmail()),this.marketingAlertSms(this.initialData.marketingAlertSms()),this.marketingAlertEmail(this.initialData.marketingAlertEmail()),this.marketingAlertPhone(this.initialData.marketingAlertPhone()),this.securityQuestion(this.initialData.securityQuestion()),this.securityAnswer(this.initialData.securityAnswer())},o.prototype.edit=function(){return this.detailsEditMode(!0)},o.prototype.cancelEdit=function(){return this.setForm(),this.detailsEditMode(!1)},o.prototype.resendActivationEmail=function(){return $.ajax(e.adminApi("PlayerInfo/ResendActivationEmail"),{type:"post",data:ko.toJSON({id:this.playerId()}),contentType:"application/json",success:function(n){return n.result==="success"?alert("Activation Email sent!"):alert("failed to resend activation email")}})},o.prototype.showSendMessageDialog=function(n){var t,r,u;return t=n.playerId,r="",u="Email",i.show(this,t,r,u)},o.prototype.setStatus=function(){var n;return n=this,$.ajax(e.adminApi("PlayerInfo/SetStatus"),{type:"post",data:ko.toJSON({id:n.playerId(),active:n.isInactive()}),contentType:"application/json",success:function(t){return t.result==="success"?n.isInactive(!t.active):alert("Can't change status")}})},o.prototype.changeFreezeStatus=function(){return $.ajax(e.adminApi("PlayerInfo/SetFreezeStatus"),{type:"post",data:ko.toJSON({playerId:this.playerId(),freeze:!this.frozen()}),contentType:"application/json",success:function(n){return function(t){return t.result!=="success"?alert("Can't freeze/unfreeze account"):n.frozen(!n.frozen())}}(this)})},o.prototype.unlock=function(){return $.ajax(e.adminApi("PlayerInfo/Unlock"),{type:"post",data:ko.toJSON({playerId:this.playerId()}),contentType:"application/json",success:function(n){return function(t){return t.result!=="success"?alert("Can't unlock the account"):n.isLocked(!1)}}(this)})},o.prototype.cancelExclusion=function(){return $.ajax(e.adminApi("PlayerInfo/CancelExclusion"),{type:"post",data:ko.toJSON({playerId:this.playerId()}),contentType:"application/json",success:function(n){return function(t){return t.result!=="success"?alert("Can't cancel exlusion on the account"):(n.isSelfExcluded(!1),n.isTimedOut(!1))}}(this)})},o.prototype.showChangeVipLevelDialog=function(n){var t,i,r,f,e;return r=n.playerId(),t=n.brand(),f=n.username(),i=n.vipLevelCode(),e=n.vipLevels,u.show(this,r,t,f,i,e)},o.prototype.showChangePaymentLevelDialog=function(n){var t,i,r,u,e;return r=n.playerId(),u=n.licensee(),t=n.brand(),i=n.paymentLevel().id(),e=n.paymentLevels,f.show(this,r,u,t,i,e)},o.prototype.clearEdit=function(){return this.firstName(""),this.lastName(""),this.email(""),this.phoneNumber(""),this.mailingAddressLine1(""),this.mailingAddressLine2(""),this.mailingAddressLine3(""),this.mailingAddressLine4(""),this.mailingAddressCity(""),this.mailingAddressPostalCode(""),this.mailingAddressStateProvince(""),this.physicalAddressLine1(""),this.physicalAddressLine2(""),this.physicalAddressLine3(""),this.physicalAddressLine4(""),this.physicalAddressCity(""),this.physicalAddressPostalCode(""),this.physicalAddressStateProvince(""),this.accountAlertSms(!1),this.accountAlertEmail(!1),this.marketingAlertSms(!1),this.marketingAlertEmail(!1),this.marketingAlertPhone(!1)},o.prototype.saveEdit=function(){var t,n;return n=this,$(n.uiElement).parent().hide().prev().show(),t={PlayerId:this.playerId,FirstName:this.firstName(),LastName:this.lastName(),DateOfBirth:this.dateOfBirth(),Title:this.title(),Gender:this.gender(),Email:this.email(),PhoneNumber:this.phoneNumber(),MailingAddressLine1:this.mailingAddressLine1(),MailingAddressLine2:this.mailingAddressLine2(),MailingAddressLine3:this.mailingAddressLine3(),MailingAddressLine4:this.mailingAddressLine4(),MailingAddressCity:this.mailingAddressCity(),MailingAddressPostalCode:this.mailingAddressPostalCode(),MailingAddressStateProvince:this.mailingAddressStateProvince(),PhysicalAddressLine1:this.physicalAddressLine1(),PhysicalAddressLine2:this.physicalAddressLine2(),PhysicalAddressLine3:this.physicalAddressLine3(),PhysicalAddressLine4:this.physicalAddressLine4(),PhysicalAddressCity:this.physicalAddressCity(),PhysicalAddressPostalCode:this.physicalAddressPostalCode(),PhysicalAddressStateProvince:this.physicalAddressStateProvince(),CountryCode:n.country().code,ContactPreference:this.contactPreference(),AccountAlertEmail:this.accountAlertEmail(),AccountAlertSms:this.accountAlertSms(),MarketingAlertEmail:this.marketingAlertEmail(),MarketingAlertSms:this.marketingAlertSms(),MarketingAlertPhone:this.marketingAlertPhone(),PaymentLevelId:this.paymentLevel().id},$.ajax({type:"POST",url:e.adminApi("PlayerInfo/Edit"),data:ko.toJSON(t),contentType:"application/json"}).done(function(i){return $(n.uiElement).parent().show().prev().hide(),i.result==="success"?(n.detailsEditMode(!1),i.data="app:players.updated",ko.mapping.fromJS(t,{},n.initialData),$("#player-grid").trigger("reload")):void 0})},o}()})}).call(this);