(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}};define(["nav","durandal/app","shell","bonus/bonusCommon","i18next","config","controls/grid"],function(t,i,r,u,f,e){return function(){function o(){this.detached=n(this.detached,this);this.compositionComplete=n(this.compositionComplete,this);this.shell=r;this.config=e;this.i18N=f;this.playerId=ko.observable();this.redemptionId=ko.observable(null);this.canBeCanceled=ko.observable(!1);this.search=ko.observable()}return o.prototype.activationFormatter=function(){return u.redemptionActivationFormatter(this.ActivationState)},o.prototype.typeFormatter=function(){return u.typeFormatter(this.TemplateType)},o.prototype.reloadGrid=function(){return $("#redemption-grid").trigger("reload")},o.prototype.compositionComplete=function(){$("#redemption-grid").on("gridLoad selectionChange",function(n){return function(t,i){return n.redemptionId(i.id),n.canBeCanceled(i.data.CanBeCanceled==="true")}}(this));return $(document).on("redemptions_changed",this.reloadGrid)},o.prototype.detached=function(){return $(document).off("redemptions_changed",this.reloadGrid)},o.prototype.openViewTab=function(){if(this.redemptionId())return t.open({path:"player-manager/info/bonus/view-redemption",title:f.t("playerManager.bonusHistory.view"),data:{playerId:this.playerId(),redemptionId:this.redemptionId()}})},o.prototype.activate=function(n){return this.playerId(n.playerId)},o.prototype.cancel=function(){if(this.redemptionId())return i.showMessage(f.t("playerManager.bonusHistory.messages.cancelRedemption"),f.t("playerManager.bonusHistory.messages.confirmCancellation"),[{text:f.t("common.booleanToYesNo.true"),value:!0},{text:f.t("common.booleanToYesNo.false"),value:!1}],!1,{style:{width:"450px"}}).then(function(n){return function(t){if(t)return $.post(e.adminApi("/BonusHistory/Cancel"),{playerId:n.playerId(),redemptionId:n.redemptionId()}).done(function(t){return t.Success?($(document).trigger("redemptions_changed"),n.canBeCanceled(!1),i.showMessage(f.t("playerManager.bonusHistory.messages.canceledSuccessfully"),f.t("playerManager.bonusHistory.cancel"),[f.t("common.close")])):i.showMessage(t.Errors[0].ErrorMessage,f.t("common.error"),[f.t("common.close")])})}}(this))},o}()})}).call(this);