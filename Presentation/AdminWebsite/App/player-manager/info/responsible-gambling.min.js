(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}};define(function(t){var u,f,i,e,r;return t("controls/grid"),f=t("config"),e=t("EntityFormUtil"),r=t("moment"),u=t("controls/confirmation-dialog/confirm-dialog"),i="YYYY/MM/DD HH:mm:ss Z",function(){function t(){this.activate=n(this.activate,this);this.update=n(this.update,this);this.isLoading=!1;this.playerId=ko.observable();this.timeZoneOffset=ko.observable();this.submitted=ko.observable();this.message=ko.observable();this.messageClass=ko.observable();this.isTimeOutEnabled=ko.observable(!1);this.isTimeOutEnabled.subscribe(function(n){return function(t){if(t&&!n.isLoading)return n.isSelfExclusionEnabled(!1),n.timeOutStartDate(r(new Date).zone(n.timeZoneOffset).format(i))}}(this));this.timeOut=ko.observable();this.timeOut.subscribe(function(n){return function(){if(n.isTimeOutEnabled())return n.timeOutStartDate(r(new Date).zone(n.timeZoneOffset).format(i))}}(this));this.timeOuts=ko.observable([{id:0,name:"24 hrs"},{id:1,name:"1 week"},{id:2,name:"1 month"},{id:3,name:"6 weeks"}]);this.timeOutStartDate=ko.observable();this.timeOutStartDate.subscribe(function(n){return function(t){if(t&&!n.isLoading)return $.get("ResponsibleGambling/GetTimeOutEndDate",{timeOutType:n.timeOut(),startDate:t}).done(function(t){return n.timeOutEndDate(r(t).zone(n.timeZoneOffset).format(i))})}}(this));this.timeOutEndDate=ko.observable();this.isSelfExclusionEnabled=ko.observable(!1);this.isSelfExclusionEnabled.subscribe(function(n){return function(t){if(t&&!n.isLoading)return n.isTimeOutEnabled(!1),n.selfExclusionStartDate(r(new Date).zone(n.timeZoneOffset).format(i))}}(this));this.selfExclusion=ko.observable();this.selfExclusion.subscribe(function(n){return function(){if(n.isSelfExclusionEnabled())return n.selfExclusionStartDate(r(new Date).zone(n.timeZoneOffset).format(i))}}(this));this.selfExclusions=ko.observable([{id:0,name:"6 months"},{id:1,name:"1 year"},{id:2,name:"5 years"},{id:3,name:"permanent"}]);this.selfExclusionStartDate=ko.observable();this.selfExclusionStartDate.subscribe(function(n){return function(t){if(t&&!n.isLoading)return $.get("ResponsibleGambling/GetSelfExclusionEndDate",{exclusionType:n.selfExclusion(),startDate:t}).done(function(t){return n.selfExclusionEndDate(r(t).zone(n.timeZoneOffset).format(i))})}}(this));this.selfExclusionEndDate=ko.observable()}return t.prototype.update=function(){var n;return this.message(""),n=new u({caption:"Player Manager",question:"Are you sure you want self exclude the player?",yesAction:function(n){return function(){return $.post("ResponsibleGambling/UpdateSelfExclusion",{playerId:n.playerId(),isTimeOutEnabled:n.isTimeOutEnabled(),timeOut:n.timeOut(),timeOutStartDate:n.timeOutStartDate(),isSelfExclusionEnabled:n.isSelfExclusionEnabled(),selfExclusion:n.selfExclusion(),selfExclusionStartDate:n.selfExclusionStartDate()}).done(function(t){return t.result==="success"?(n.message("Account has been successfully self-excluded."),n.messageClass("alert-success")):(n.message("Fail."),n.messageClass("alert-danger"))})}}(this)}),n.show()},t.prototype.activate=function(n){return this.playerId(n.playerId),$.get("ResponsibleGambling/GetData",{playerId:this.playerId()}).done(function(n){return function(t){if(t)return n.isLoading=!0,n.timeZoneOffset=t.timeZoneOffset,n.timeOut(t.timeOut),n.isTimeOutEnabled(t.isTimeOutEnabled),t.timeOutStartDate?n.timeOutStartDate(r(t.timeOutStartDate).zone(n.timeZoneOffset).format(i)):n.timeOutStartDate(r(new Date).zone(n.timeZoneOffset).format(i)),n.timeOutEndDate(r(t.timeOutEndDate).zone(n.timeZoneOffset).format(i)),n.selfExclusion(t.selfExclusion),n.isSelfExclusionEnabled(t.isSelfExclusionEnabled),t.selfExclusionStartDate?n.selfExclusionStartDate(r(t.selfExclusionStartDate).zone(n.timeZoneOffset).format(i)):n.selfExclusionStartDate(r(new Date).zone(n.timeZoneOffset).format(i)),n.selfExclusionEndDate(r(t.selfExclusionEndDate).zone(n.timeZoneOffset).format(i)),n.isLoading=!1}}(this))},t}()})}).call(this);