(function(){define(["nav","i18next"],function(n,t){return function(){function i(){var i,n;n=ko.observables();this.message=n[0];this.messageClass=n[1];this.playerId=n[2];this.username=n[3];this.selectedBankAccount=n[4];this.selectedBonus=n[5];this.disable=ko.observable(!1);this.banks=ko.observableArray();this.amount=ko.observable().extend({formatDecimal:2,validatable:!0,required:!0,min:{message:"Entered amount must be greater than 0.",params:.01},max:{message:"Entered amount is bigger than allowed.",params:2147483647}});i={id:null,name:t.t("app:common.none"),code:null};this.bonuses=ko.observableArray([i]);this.selectedBonus(i);this.bonusFormatter=function(n){return n.code!=null?""+n.code+": "+n.name:""+n.name};this.errors=ko.validation.group(this);this.IsJsonString=function(n){var t;try{return JSON.parse(n),!0}catch(i){return t=i,!1}}}return i.prototype.close=function(){return n.close()},i.prototype.activate=function(n){return $.get("/offlineDeposit/GetInfoForCreate",{playerId:n.playerId}).done(function(i){return function(r){var u;return u=r.data.banks,i.banks(u),u.length===0&&(i.disable(!0),i.message(t.t("app:payment.paymentLevelDisableOfflineDeposit")),i.messageClass("alert-danger")),i.username(r.data.username),i.playerId(n.playerId),r.data.bonuses.forEach(function(n){return i.bonuses.push(n)})}}(this))},i.prototype.sendRequest=function(){return this.isValid()?(this.message(null),this.messageClass(null),$.post("/offlineDeposit/Create",{playerId:this.playerId(),bankAccountId:this.selectedBankAccount().id,bonusId:this.selectedBonus().id,amount:this.amount()}).done(function(i){return function(r){var u;return r.result==="failed"?(i.IsJsonString(r.data)?(u=JSON.parse(r.data),i.message(t.t("app:payment.deposit.depositFailed")+t.t(u.text,u.variables))):i.message(t.t("app:payment.deposit.depositFailed")+t.t(r.data)),i.messageClass("alert-danger")):($("#offline-deposit-confirm-grid").trigger("reload"),i.close(),n.open({path:"player-manager/offline-deposit/view-request",title:t.t("app:payment.offlineDepositRequest.view"),data:{hash:"#offline-deposit-view",requestId:r.data,message:t.t("app:payment.deposit.successfullyCreated")}}))}}(this))):this.errors.showAllMessages()},i}()})}).call(this);