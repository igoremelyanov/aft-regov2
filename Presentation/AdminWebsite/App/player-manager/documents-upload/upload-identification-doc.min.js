(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}};define(function(t){var u,r,i,o,f,e,s;return e=t("nav"),o=t("komapping"),i=t("i18next"),s=t("datePicker"),r=t("config"),f=t("moment"),u=function(){function t(){this.forceValidation=n(this.forceValidation,this);this.initializeViewModel()}return t.prototype.initializeViewModel=function(){var n;return this.SavePath=r.adminApi("PlayerInfo/UploadId"),this.playerId=ko.observable(),this.message=ko.observable(),this.messageClass=ko.observable(),this.submitted=ko.observable(),this.licensee=ko.observable().extend({required:!0}),this.brand=ko.observable().extend({required:!0}),this.documentType=ko.observable().extend({required:!0}),this.username=ko.observable(),this.documentTypes=ko.observableArray(),this.isIdOrCredit=ko.computed(function(n){return function(){return n.documentType()==="Id"||n.documentType()==="CreditCard"}}(this)),this.firstFileUploaderLabel=ko.computed(function(n){return function(){return n.isIdOrCredit?i.t("playerManager.identificationDocuments.labels.idFrontUpload"):"Upload Document"}}(this)),this.cardNumber=ko.observable().extend({required:{onlyIf:this.isIdOrCredit},minLength:1,maxLength:20,pattern:{message:i.t("app:common.validationMessages.onlyNumeric").replace("__fieldName__",i.t("app:playerManager.identificationDocuments.labels.cardNumber")),params:"^[0-9]+$"}}),this.cardExpirationDate=ko.observable(),this.cardExpirationDate.extend({required:{onlyIf:this.isIdOrCredit},validation:{validator:function(n){return function(t){return n.isIdOrCredit()?f().diff(t)<0:!0}}(this),message:"Expiration Date is not valid.",params:this.isIdOrCredit}}),this.uploadId1FieldId=ko.observable("deposit-confirm-upload-id-1"),this.uploadId2FieldId=ko.observable("deposit-confirm-upload-id-2"),n="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjE1MCIgeT0iMTAwIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjE5cHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+MzAweDIwMDwvdGV4dD48L3N2Zz4=",this.uploadId1Src=ko.observable(n),this.uploadId2Src=ko.observable(n),this.maxSize=4194304,this.idFrontImage=ko.observable().extend({required:!0,validation:{validator:function(n){return function(){var t,i;return t=$("input#"+n.uploadId1FieldId())[0],i=t?t.files[0]:void 0,i&&i.size<=n.maxSize}}(this),message:"Maximum file size is 4Mb."}}),this.idBackImage=ko.observable().extend({validation:[{validator:function(n){return function(){var t,i;return(t=$("input#"+n.uploadId2FieldId())[0],i=t?t.files[0]:void 0,i===void 0)?!0:i.size<=n.maxSize}}(this),message:"Maximum file size is 4Mb."},{validator:function(n){return function(t,i){var r,u;if(i()){if(r=$("input#"+n.uploadId2FieldId())[0],u=r?r.files[0]:void 0,u===void 0)return!1;!0}return!0}}(this),message:"Both sides of the documents should be uploaded.",params:this.isIdOrCredit}]}),this.remarks=ko.observable().extend({maxLength:200}),this.errors=ko.validation.group(this)},t.prototype.compositionComplete=function(){return $("input#"+this.uploadId1FieldId()).ace_file_input(this.makeFileInputSettings(this.idFrontImage)),$("input#"+this.uploadId2FieldId()).ace_file_input(this.makeFileInputSettings(this.idBackImage))},t.prototype.makeFileInputSettings=function(n){return{style:"well",btn_choose:"Drop image or click to choose",no_file:"No File ...",droppable:!0,thumbnail:"fit",before_change:function(t){var r,u;return r=t[0],typeof r=="string"?/\.(jpe?g|png|gif)$/i.test(r)||(n(""),alert(i.t("app:payment.deposit.pleaseSelectImage")),-1):(u=$.trim(r.type),(u.length>0&&!/^image\/(jpe?g|png|gif)$/i.test(u)||u.length===0&&!/\.(jpe?g|png|gif)$/i.test(r.name))&&(n(""),alert(i.t("app:payment.deposit.pleaseSelectImage")),-1)),!0}}},t.prototype.showError=function(n){return this.message(n),this.messageClass("alert alert-danger")},t.prototype.showMessage=function(n){return this.message(n),this.messageClass("alert alert-success")},t.prototype.clearMessage=function(){return this.message(""),this.messageClass("")},t.prototype.cancel=function(){return e.close()},t.prototype.clear=function(){return this.clearMessage(),this.licensee(""),this.licensee.isModified(!1),this.brand(""),this.brand.isModified(!1),this.documentType(""),this.documentType.isModified(!1),this.cardNumber(""),this.cardNumber.isModified(!1),this.cardExpirationDate(""),this.cardExpirationDate.isModified(!1),this.idFrontImage(""),this.idFrontImage.isModified(!1),this.idBackImage(""),this.idBackImage.isModified(!1),this.remarks(""),this.remarks.isModified(!1)},t.prototype.activate=function(n){return this.playerId(n.playerId),this.clear(),this.submitted(!1),this.load()},t.prototype.load=function(){return $.get(r.adminApi("PlayerInfo/GetIdentificationDocumentEditData?id="+this.playerId())).done(function(n){return function(t){return n.licensee(t.licenseeName),n.brand(t.brandName),n.username(t.username),n.documentTypes(t.documentTypes)}}(this))},t.prototype.forceValidation=function(){return this.idBackImage(this.idBackImage()),this.idFrontImage(this.idFrontImage())},t.prototype.save=function(){var n,t;return this.clearMessage(),this.forceValidation(),this.isValid()?(t={documentType:this.documentType(),cardNumber:this.cardNumber(),cardExpirationDate:this.cardExpirationDate(),remarks:this.remarks()},n=new FormData,n.append("uploadId1",$("input#"+this.uploadId1FieldId())[0].files[0]),n.append("uploadId2",$("input#"+this.uploadId2FieldId())[0].files[0]),n.append("data",JSON.stringify(t)),n.append("playerId",this.playerId()),$.ajax({type:"POST",url:this.SavePath,data:n,processData:!1,contentType:!1,xhr:function(n){return function(){var t;return t=new XMLHttpRequest,t.onreadystatechange=function(){var i;if(4===t.readyState)return i=JSON.parse(t.responseText),i.result==="failed"?n.showError(i.data):($("#id-documents-grid").trigger("reload"),i.data.frontIdFilename&&n.uploadId1Src("image/Show?fileId="+i.data.frontIdFilename+"&playerId="+n.playerId()),i.data.backIdFilename&&n.uploadId2Src("image/Show?fileId="+i.data.backIdFilename+"&playerId="+n.playerId()),n.showMessage("Documents have been uploaded successfully."),n.submitted(!0)),$("input#"+n.uploadId1FieldId()).data().ace_file_input.disable(),$("input#"+n.uploadId2FieldId()).data().ace_file_input.disable()},t}}(this)})):this.errors.showAllMessages()},t}(),new u})}).call(this);