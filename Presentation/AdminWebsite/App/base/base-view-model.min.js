(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}};define(function(t){var i,u,r;return u=t("komapping"),r=t("nav"),i=t("i18next"),function(){function t(){this.save=n(this.save,this);this.submitted=ko.observable(!1);this.isReadOnly=ko.observable(!1);this.contentType=ko.observable("application/x-www-form-urlencoded");this.message=ko.observable();this.messageCss=ko.observable();this.cancelText=ko.observable(i.t("app:common.cancel"))}return t.prototype.cancel=function(){return r.close()},t.prototype.beforesave=function(){return!0},t.prototype.onsave=function(){},t.prototype.onfail=function(){},t.prototype.readOnly=function(n){return this.isReadOnly(n)},t.prototype.success=function(n){return this.messageCss("alert alert-success left"),this.message(n)},t.prototype.fail=function(n){return this.messageCss("alert alert-danger left"),this.message(n)},t.prototype.renameTab=function(n){return r.title(n)},t.prototype.reset=function(){return this.readOnly(!1),this.message(null),this.submitted(!1),this.cancelText(i.t("app:common.cancel"))},t.prototype.submit=function(){return this.submitted(!0),this.cancelText(i.t("app:common.close"))},t.prototype.save=function(){if(this.Model.validate()){if(this.beforesave())return $.ajax({type:"POST",url:this.SavePath,data:this.contentType().indexOf("json")>-1?ko.toJSON(this.Model):this.Model.mapto(),contentType:this.contentType()}).done(function(n){return function(t){if(t.result==="success"){n.submit();return n.onsave(t)}n.onfail(t);return n.handleSaveFailure(t),n.Model.serverErrors.push(t.data)}}(this))}else return this.Model.errors.showAllMessages()},t.prototype.setError=function(n,t){return n.error=t,n.__valid__(!1)},t.prototype.handleSaveFailure=function(n){var t,f,e,r,u,o;if(r=n!=null?n.fields:void 0,r!=null)for(u=0,o=r.length;u<o;u++)e=r[u],t=e.errors[0],t.fieldName?this.setError(this.Model[t.fieldName],t.errorMessage):(f=JSON.parse(t),this.setError(this.Model[e.name],i.t(f.text,f.variables)));return this.Model.errors.showAllMessages()},t.prototype.clear=function(){return this.Model.clear()},t.prototype.activate=function(){return this.reset()},t}()})}).call(this);