(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}};define(["nav","durandal/app","i18next","security/security","shell","bonus/bonusCommon","config","controls/grid"],function(t,i,r,u,f,e,o){return function(){function s(){this.detached=n(this.detached,this);this.compositionComplete=n(this.compositionComplete,this);this.shell=f;this.config=o;this.templateId=ko.observable();this.canBeEdited=ko.observable(!1);this.canBeDeleted=ko.observable(!1);this.complete=ko.observable(!1);this.search=ko.observable("")}return s.prototype.typeFormatter=function(){return e.typeFormatter(this.Type)},s.prototype.statusFormatter=function(){return r.t("bonus.templateStatuses."+this.Status)},s.prototype.issuanceModeFormatter=function(){return e.issuanceModeFormatter(this.Mode)},s.prototype.isAddBtnVisible=ko.computed(function(){return u.isOperationAllowed(u.permissions.create,u.categories.bonusTemplateManager)}),s.prototype.isEditBtnVisible=ko.computed(function(){return u.isOperationAllowed(u.permissions.update,u.categories.bonusTemplateManager)}),s.prototype.isDeleteBtnVisible=ko.computed(function(){return u.isOperationAllowed(u.permissions["delete"],u.categories.bonusTemplateManager)}),s.prototype.isViewBtnVisible=ko.computed(function(){return u.isOperationAllowed(u.permissions.view,u.categories.bonusTemplateManager)}),s.prototype.openAddTemplateTab=function(){return t.open({path:"bonus/template-manager/wizard",title:r.t("bonus.templateManager.new")})},s.prototype.openEditTemplateTab=function(){if(this.templateId())return t.open({path:"bonus/template-manager/wizard",title:r.t("bonus.templateManager.edit"),data:{id:this.templateId(),complete:this.complete()}})},s.prototype.openViewTemplateTab=function(){if(this.templateId())return t.open({path:"bonus/template-manager/wizard",title:r.t("bonus.templateManager.view"),data:{id:this.templateId(),view:!0}})},s.prototype.deleteTemplate=function(){if(this.templateId())return i.showMessage(r.t("bonus.messages.deleteTemplate"),r.t("bonus.messages.confirmTemplateDeletion"),[{text:r.t("common.booleanToYesNo.true"),value:!0},{text:r.t("common.booleanToYesNo.false"),value:!1}],!1,{style:{width:"350px"}}).then(function(n){return function(t){if(t)return $.ajax({type:"POST",url:o.adminApi("BonusTemplate/Delete"),data:ko.toJSON({templateId:n.templateId()}),dataType:"json",contentType:"application/json"}).done(function(t){return t.Success?($(document).trigger("bonus_templates_changed"),n.canBeEditedDeleted(!1),i.showMessage(r.t("bonus.messages.deletedSuccessfully"),r.t("bonus.templateManager.delete"),[r.t("common.close")])):i.showMessage(t.Errors[0].ErrorMessage,r.t("common.error"),[r.t("common.close")])})}}(this))},s.prototype.reloadGrid=function(){return $("#bonus-template-grid").trigger("reload")},s.prototype.compositionComplete=function(){$("#bonus-template-grid").on("gridLoad selectionChange",function(n){return function(t,i){return n.templateId(i.id),n.canBeEdited(i.data.CanBeEdited==="true"),n.canBeDeleted(i.data.CanBeDeleted==="true"),n.complete(i.data.Status===r.t("bonus.templateStatuses.1"))}}(this));$("#bonus-template-search").submit(function(n){return function(){return n.search($("#template-name-search").val()),!1}}(this));return $(document).on("bonus_templates_changed",this.reloadGrid)},s.prototype.detached=function(){return $(document).off("bonus_templates_changed",this.reloadGrid)},s}()})}).call(this);