(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}},t={}.hasOwnProperty,i=function(n,i){function u(){this.constructor=n}for(var r in i)t.call(i,r)&&(n[r]=i[r]);return u.prototype=i.prototype,n.prototype=new u,n.__super__=i.prototype,n};define(["./bonusBase","bonus/bonusCommon","komapping","nav","config","i18next","dateBinders"],function(t,r,u,f,e,o){return function(t){function s(){this.detached=n(this.detached,this);this.activate=n(this.activate,this);this.processResponse=n(this.processResponse,this);this.submit=n(this.submit,this);this.getBrandField=n(this.getBrandField,this);s.__super__.constructor.call(this);this.ActiveTo.subscribe(function(n){return function(){return n.ActiveTo.isModified(!1)}}(this));this.vLicenseeName=ko.computed(function(n){return function(){return n.getBrandField("LicenseeName")}}(this));this.vBrandName=ko.computed(function(n){return function(){return n.getBrandField("BrandName")}}(this));this.vRequireBonusCode=ko.computed(function(n){return function(){var t;return t=ko.utils.arrayFirst(n.templates(),function(t){return t.Id===n.TemplateId()}),t!=null?t.RequireBonusCode:void 0}}(this));this.Code.extend({required:{params:!0,message:o.t("common.requiredField"),onlyIf:this.vRequireBonusCode}})}return i(s,t),s.prototype.getBrandField=function(n){var t;return t=ko.utils.arrayFirst(this.templates(),function(n){return function(t){return t.Id===n.TemplateId()}}(this)),t!=null?t[n]:this.emptyCaption()},s.prototype.submit=function(){var n;return this.isValid()?(n=JSON.parse(u.toJSON(this,{ignore:r.getIgnoredFieldNames(this)})),$.ajax({type:"POST",url:e.adminApi("Bonus/CreateUpdate"),data:ko.toJSON(n),dataType:"json",contentType:"application/json"}).done(function(n){return function(t){return n.processResponse(t)}}(this))):this.errors.showAllMessages()},s.prototype.processResponse=function(n){var t;return n.Success?(this.cancel(),$(document).trigger("bonuses_changed"),t={id:n.BonusId},t[this.Id()===void 0?"created":"edited"]=!0,f.open({path:"bonus/bonus-manager/view-bonus",title:o.t("bonus.bonusManager.view"),data:t})):(n.Errors.forEach(function(n){return function(t){return t.PropertyName==="Bonus"?n.serverErrors([t.ErrorMessage]):setError(n[t.PropertyName],t.ErrorMessage)}}(this)),this.errors.showAllMessages())},s.prototype.activate=function(n){$(document).on("bonus_templates_changed",this.reloadTemplates);return $.get(e.adminApi("Bonus/GetRelatedData"),{id:n!=null?n.id:void 0}).done(function(t){return function(i){return t.templates(i.Templates),n!=null?(u.fromJS(i.Bonus,{},t),t.TemplateId.valueHasMutated()):void 0}}(this))},s.prototype.detached=function(){return $(document).off("bonuses_changed",this.reloadTemplates)},s}(t)})}).call(this);