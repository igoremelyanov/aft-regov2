(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}};define(["nav","i18next","security/security","./activate-dialog","shell","bonus/bonusCommon","config","controls/grid"],function(t,i,r,u,f,e,o){return function(){function s(){this.detached=n(this.detached,this);this.compositionComplete=n(this.compositionComplete,this);this.shell=f;this.config=o;this.bonusId=ko.observable(null);this.isActivateEnabled=ko.observable(!1);this.isDeactivateEnabled=ko.observable(!1);this.search=ko.observable("");this.selectedBrands=ko.computed(function(){return f.selectedBrandsIds()});this.isEditEnabled=ko.computed(function(n){return function(){return n.bonusId()&&n.isActivateEnabled()}}(this))}return s.prototype.typeFormatter=function(){return e.typeFormatter(this.Type)},s.prototype.issuanceModeFormatter=function(){return e.issuanceModeFormatter(this.Mode)},s.prototype.statusFormatter=function(){return i.t("bonus.bonusStatuses."+this.IsActive)},s.prototype.isAddBtnVisible=ko.computed(function(){return r.isOperationAllowed(r.permissions.create,r.categories.bonusManager)}),s.prototype.isEditBtnVisible=ko.computed(function(){return r.isOperationAllowed(r.permissions.update,r.categories.bonusManager)}),s.prototype.isViewBtnVisible=ko.computed(function(){return r.isOperationAllowed(r.permissions.view,r.categories.bonusManager)}),s.prototype.isActivateBtnVisible=ko.computed(function(){return r.isOperationAllowed(r.permissions.activate,r.categories.bonusManager)}),s.prototype.isDeactivateBtnVisible=ko.computed(function(){return r.isOperationAllowed(r.permissions.deactivate,r.categories.bonusManager)}),s.prototype.openAddBonusTab=function(){return t.open({path:"bonus/bonus-manager/add-edit-bonus",title:i.t("bonus.bonusManager.new")})},s.prototype.openEditBonusTab=function(){if(this.bonusId())return t.open({path:"bonus/bonus-manager/add-edit-bonus",title:i.t("bonus.bonusManager.edit"),data:{id:this.bonusId()}})},s.prototype.openViewBonusTab=function(){if(this.bonusId())return t.open({path:"bonus/bonus-manager/view-bonus",title:i.t("bonus.bonusManager.view"),data:{id:this.bonusId()}})},s.prototype.showModalDialog=function(n){var t;return t=new u(this.bonusId()),t.show(n)},s.prototype.reloadGrid=function(){return $("#bonus-grid").trigger("reload")},s.prototype.compositionComplete=function(){$("#bonus-grid").on("gridLoad selectionChange",function(n){return function(t,i){return n.bonusId(i.id),i.data.BrandId!==""?(n.isActivateEnabled(i.data.IsActive==="Inactive"&&n.bonusId()!=null),n.isDeactivateEnabled(i.data.IsActive==="Active"&&n.bonusId()!=null)):(n.isActivateEnabled(!1),n.isDeactivateEnabled(!1))}}(this));$("#bonus-search").submit(function(n){return function(){return n.search($("#bonus-name-search").val()),!1}}(this));return $(document).on("bonuses_changed",this.reloadGrid)},s.prototype.detached=function(){return $(document).off("bonuses_changed",this.reloadGrid)},s}()})}).call(this);