(function(){define(function(n){var i,r,u,f,e,t,o;return n("dateBinders"),n("controls/grid"),t=n("moment"),e=n("i18next"),i=[{name:"equal",title:"is",jqGridOp:"eq"},{name:"equalTo",title:"is equal to",jqGridOp:"eq"},{name:"isListItem",title:"is",jqGridOp:"eq"},{name:"less",title:"less than",jqGridOp:"lt"},{name:"before",title:"before",jqGridOp:"lt"},{name:"lessOrEqual",title:"less than or equal to",jqGridOp:"le"},{name:"<=",title:"<=",jqGridOp:"le"},{name:"greater",title:"greater than",jqGridOp:"gt"},{name:"after",title:"after",jqGridOp:"gt"},{name:"greaterOrEqual",title:"greater than or equal to",jqGridOp:"ge"},{name:">=",title:">=",jqGridOp:"ge"},{name:"contains",title:"contains",jqGridOp:"cn"},{name:"on",title:"is on"},{name:"between",title:"is between"},{name:"isOneOfListItems",title:"is one of"}],r=[{name:"unique",availableConditions:["equal"]},{name:"text",availableConditions:["equal","contains"]},{name:"numeric",availableConditions:["equalTo","between","greater","less","greaterOrEqual","lessOrEqual"]},{name:"amount",availableConditions:[">=","<="]},{name:"date",availableConditions:["between","on","before","after"]},{name:"list",availableConditions:["isListItem","isOneOfListItems"]},{name:"bool",availableConditions:["isListItem"]},{name:"enum",availableConditions:["isListItem"]}],o=function(n){return"/Date("+t(n).valueOf()+")/"},f=function(){function n(n,t,i,u){this.fieldName=n;this.title=t;this.fieldType=i;this.availableValues=u;this.availableValues=ko.observable(ko.unwrap(this.availableValues||[]));this.fieldType==="bool"&&this.availableValues({True:"Yes",False:"No"});this.getFieldType=function(n){return function(){return ko.utils.arrayFirst(r,function(t){return t.name===n.fieldType})}}(this);this.localizedTitle=ko.computed(function(n){return function(){return t=ko.unwrap(n.title),t.indexOf("app:")!==0?n.title:e.t(n.title)}}(this))}return n}(),u=function(){function n(n,u,f,e){this.filterField=n;this.condition=u;this.value=f;this.value2=e;this.selectedValue=ko.observable(ko.unwrap(this.value));this.values=ko.observableArray([ko.unwrap(this.value)]);this.dateFrom=ko.observable(t());this.dateTo=ko.observable(t());this.conditions=ko.computed(function(n){return function(){var t;return n.filterField()!=null?(t=ko.utils.arrayFirst(r,function(t){return t.name===n.filterField().fieldType}),t.availableConditions.map(function(n){return ko.utils.arrayFirst(i,function(t){return t.name===n})})):[]}}(this),this);this.updateMultiCheckbox=function(){return $(".filter-row .ui-dropdownchecklist").remove(),$(".filter-row select[name=multiValues]").dropdownchecklist()};this.filterField.subscribe(function(n){return function(){return setTimeout(n.updateMultiCheckbox,50)}}(this));this.condition.subscribe(function(n){return function(){return setTimeout(n.updateMultiCheckbox,50)}}(this));this.values.subscribe(function(n){return function(){return console.log(n.values())}}(this));this.listValues=ko.computed(function(n){return function(){var r,t,i,o,s,u,e;if(t=(s=n.filterField())!=null?s.availableValues():void 0,Array.isArray(t)){for(u=[],i=0,o=t.length;i<o;i++)f=t[i],u.push({value:f,title:f});return u}e=[];for(r in t)f=t[r],e.push({value:r,title:f});return e}}(this));this.isDate=ko.computed(function(n){return function(){var t;return((t=n.filterField())!=null?t.fieldType:void 0)==="date"}}(this));this.isRange=ko.computed(function(n){return function(){return n.condition()==="between"}}(this));this.isTextOrNumeric=ko.computed(function(n){return function(){var t,i,r,u;return((t=n.filterField())!=null?t.fieldType:void 0)==="text"||((i=n.filterField())!=null?i.fieldType:void 0)==="numeric"||((r=n.filterField())!=null?r.fieldType:void 0)==="amount"||((u=n.filterField())!=null?u.fieldType:void 0)==="unique"}}(this));this.isDateRange=ko.computed(function(n){return function(){return n.isDate()&&n.isRange()}}(this));this.isSingleDate=ko.computed(function(n){return function(){return n.isDate()&&!n.isRange()}}(this));this.isNumericRange=ko.computed(function(n){return function(){var t;return((t=n.filterField())!=null?t.fieldType:void 0)==="numeric"&&n.isRange()}}(this));this.isDropDownList=ko.computed(function(n){return function(){return n.condition()==="isListItem"}}(this));this.isMultiChekboxList=ko.computed(function(n){return function(){return n.condition()==="isOneOfListItems"}}(this))}return n}(),function(){function n(){this.fields=ko.observableArray();this.criteria=ko.observableArray();this.addFilterCriterion();this.hasCriteria=ko.computed(function(n){return function(){return ko.utils.arrayFirst(n.criteria(),function(n){return n.filterField()!=null})!=null}}(this));this.getField=function(n){return function(t){return ko.utils.arrayFirst(n.fields(),function(n){return n.fieldName===t})}}(this);this.activate=function(n){return function(t,i){var r;if(t!=null&&n.fields(function(){var n,e,i,u;for(i=ko.unwrap(t),u=[],n=0,e=i.length;n<e;n++)r=i[n],u.push(function(n,t,i){i.prototype=n.prototype;var u=new i,r=n.apply(u,t);return Object(r)===r?r:u}(f,r,function(){}));return u}()),i!=null)return i===ko.unwrap(i)&&(i=ko.observable(i||{})),n.updateCriteria(i),n.subscription=i.subscribe(function(t){return n.updateCriteria(t)})}}(this);this.attached=function(n){return function(t){var i;if((i=findGrid(t)).length)return i[0].filters=n}}(this);this.detached=function(n){return function(){if(n.subscription!=null)return n.subscription.dispose()}}(this);this.updateCriteria=function(n){return function(t){var i,r;return n.criteria(function(){var n,f;n=ko.unwrap(t);f=[];for(i in n)r=n[i],f.push(new u(ko.observable(this.getField(i)),ko.observable(this.getField(i).getFieldType().availableConditions[0]),ko.observable(r),ko.observable("")));return f}.call(n)),n.addFilterCriterion()}}(this);this.toJqGridFilters=ko.computed(function(n){return function(){var f,p,r,e,o,l,a,u,s,k,v,h,c,w,b,y;for(u=[],y=n.criteria(),h=0,w=y.length;h<w;h++)if(r=y[h],r.filterField()&&(r.value()&&(r.value2()||!r.isNumericRange())||r.isDate()&&r.dateFrom()||r.selectedValue()&&r.isDropDownList()||r.values()&&r.isMultiChekboxList()))if(p=ko.utils.arrayFirst(i,function(n){return n.name===ko.unwrap(r.condition)}),e=ko.unwrap(r.filterField).fieldName,r.isDate()){o=t(r.dateFrom());s=t(r.isRange()?r.dateTo():r.dateFrom());switch(r.condition()){case"between":case"on":s=s.add(1,"days");break;case"after":o=o.add(1,"days")}r.condition()!=="before"&&u.push({field:e,op:"ge",data:o.format("YYYY-MM-DD")});r.condition()!=="after"&&u.push({field:e,op:"lt",data:s.format("YYYY-MM-DD")})}else if(r.isMultiChekboxList())for(v=ko.unwrap(r.values),u.push({field:e,op:"in",data:JSON.stringify(v)}),f=ko.unwrap(r.filterField).availableValues(),Array.isArray(f)||(f=function(){var n=[];for(l in f)k=f[l],n.push(l);return n}()),c=0,b=f.length;c<b;c++)a=f[c],v.indexOf(a)===-1&&u.push({field:e,op:"ne",data:a});else u.push({field:e,op:r.isRange()?"ge":p.jqGridOp,data:ko.unwrap(r.isDropDownList()?r.selectedValue:r.value)}),r.isRange()&&u.push({field:e,op:"le",data:ko.unwrap(r.value2)});return{groupOp:"AND",rules:u}}}(this),this)}return n.prototype.addField=function(n,t){return this.fields.push(new f(n,t))},n.prototype.addFilterCriterion=function(){return this.criteria.push(new u(ko.observable(),ko.observable("equal"),ko.observable(""),ko.observable("")))},n.prototype.removeFilterCriterion=function(n){return this.criteria.remove(n)},n.prototype.clearFilter=function(){return this.criteria([]),this.addFilterCriterion()},n}()})}).call(this);