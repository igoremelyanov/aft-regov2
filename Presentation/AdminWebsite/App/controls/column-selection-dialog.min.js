(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}};define(function(){var i,t;return t=require("plugins/dialog"),i=require("controls/assign"),function(){function r(t,r,u,f){this.grid=t;this.columnStorage=u;f==null&&(f=null);this.ok=n(this.ok,this);this.updateGrid=n(this.updateGrid,this);this.columns=ko.unwrap(r||[]).map(function(n){return{value:n[0],name:n[1]}});this.hiddenColumns=f!=null?f.slice(0):JSON.parse(localStorage.getItem(this.columnStorage)||"[]");this.hiddenColumns||(this.hiddenColumns=[]);this.needToPersistentColumns=f==null;this.assignControl=new i;this.assignControl.availableItems(this.columns.filter(function(n){return function(t){return~n.hiddenColumns.indexOf(t.value)}}(this)));this.assignControl.assignedItems(this.columns.filter(function(n){return function(t){return!~n.hiddenColumns.indexOf(t.value)}}(this)));this.updateGrid()}return r.prototype.updateGrid=function(){return this.hiddenColumns=this.assignControl.availableItems().map(function(n){return n.value}),this.grid.showColumns(this.assignControl.assignedItems().map(function(n){return n.value})),this.grid.hideColumns(this.hiddenColumns)},r.prototype.ok=function(){return this.updateGrid(),this.needToPersistentColumns&&localStorage.setItem(this.columnStorage,JSON.stringify(this.assignControl.availableItems().map(function(n){return n.value}))),t.close(this,this.hiddenColumns)},r.prototype.cancel=function(){return t.close(this)},r.prototype.show=function(){return t.show(this)},r}()})}).call(this);