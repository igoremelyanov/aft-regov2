// Generated by IcedCoffeeScript 108.0.9
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(function(require) {
    var EditBankAccountModel, baseModel, common, config, i18n, moment, picker, regex;
    i18n = require("i18next");
    picker = require("datePicker");
    config = require("config");
    common = require("payments/bank-accounts/common");
    regex = require("regular-expression");
    baseModel = require("base/base-model");
    moment = require("moment");
    return EditBankAccountModel = (function(_super) {
      __extends(EditBankAccountModel, _super);

      function EditBankAccountModel(bankAccount) {
        var defaultImagePreviewSrc;
        EditBankAccountModel.__super__.constructor.apply(this, arguments);
        this.submitted = ko.observable();
        this.id = this.makeField(bankAccount.id);
        this.isActive = this.makeField(bankAccount.isActive);
        this.licenseeId = this.makeField().extend({
          required: true
        });
        this.licenseeName = this.makeField(bankAccount.licenseeName);
        this.brandId = this.makeField().extend({
          required: true
        });
        this.brandName = this.makeField(bankAccount.brandName);
        this.bankId = ko.observable(bankAccount.bankId).extend({
          required: true
        });
        this.bankAccountAccountTypeId = ko.observable(bankAccount.bankAccountAccountTypeId).extend({
          required: true
        });
        this.bankAccountAccountTypes = this.makeSelect();
        this.bankName = this.makeField(bankAccount.bankName);
        this.banks = this.makeSelect();
        this.currencyCode = this.makeField(bankAccount.currencyCode).extend({
          required: true
        });
        this.remarks = this.makeField(bankAccount.remarks).extend({
          required: true,
          maxLength: common.remarksMaxLength
        });
        this.bankAccountId = this.makeField(bankAccount.bankAccountId).extend({
          required: true,
          maxLength: common.bankIdMaxLength,
          pattern: {
            message: i18n.t("bankAccounts.validation.AlphanumericDashUnderscoreSpace"),
            params: regex.alphaNumericDashUnderscoreSpace
          }
        });
        this.bankAccountNumber = this.makeField(bankAccount.bankAccountNumber).extend({
          required: true,
          maxLength: common.bankAccountNumberMaxLength,
          pattern: {
            message: i18n.t("bankAccounts.validation.AlphanumericDashUnderscoreSpace"),
            params: regex.alphaNumericDashUnderscoreSpace
          }
        });
        this.bankAccountName = this.makeField(bankAccount.bankAccountName).extend({
          required: true,
          maxLength: common.bankAccountNameMaxLength,
          pattern: {
            message: i18n.t("bankAccounts.validation.AlphanumericDashUnderscoreSpace"),
            params: regex.alphaNumericDashUnderscoreSpace
          }
        });
        this.bankAccountProvince = this.makeField(bankAccount.bankAccountProvince).extend({
          required: true,
          maxLength: common.bankAccountProvinceMaxLength,
          pattern: {
            message: i18n.t("bankAccounts.validation.AlphanumericDashUnderscoreSpace"),
            params: regex.alphaNumericDashUnderscoreSpace
          }
        });
        this.bankAccountBranch = this.makeField(bankAccount.bankAccountBranch).extend({
          required: true,
          maxLength: common.bankAccountBranchMaxLength,
          pattern: {
            message: i18n.t("bankAccounts.validation.AlphanumericDashUnderscoreSpace"),
            params: regex.alphaNumericDashUnderscoreSpace
          }
        });
        this.supplierName = this.makeField(bankAccount.supplierName).extend({
          required: true,
          maxLength: common.supplierNameMaxLength
        });
        this.contactNumber = this.makeField(bankAccount.contactNumber).extend({
          required: true,
          maxLength: common.contactNumberMaxLength,
          pattern: {
            message: i18n.t("bankAccounts.validation.Numeric"),
            params: regex.numeric
          }
        });
        this.usbCode = this.makeField(bankAccount.usbCode).extend({
          required: true,
          maxLength: common.usbCodeMaxLength,
          pattern: {
            message: i18n.t("bankAccounts.validation.Alphanumeric"),
            params: regex.alphaNumeric
          }
        });
        this.purchasedDate = this.makeField(bankAccount.purchasedDate).extend({
          required: true
        });
        this.cardPurchasedDate = this.makeField();
        this.cardPurchasedDate.extend({
          validation: {
            validator: (function(_this) {
              return function(val) {
                moment().diff(_this.cardPurchasedDate()) < 0;
                return true;
              };
            })(this),
            message: 'Expiration Date is not valid.'
          }
        });
        this.utilizationDate = this.makeField(bankAccount.utilizationDate).extend({
          required: true
        });
        this.expirationDate = this.makeField(bankAccount.expirationDate).extend({
          required: true
        });
        this.uploadId1FieldId = ko.observable("bank-account-upload-id-1");
        this.uploadId2FieldId = ko.observable("bank-account-upload-id-2");
        this.uploadId3FieldId = ko.observable("bank-account-upload-id-3");
        defaultImagePreviewSrc = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjE1MCIgeT0iMTAwIiBzdHlsZT0iZmlsbDojYWFhO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1zaXplOjE5cHg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7ZG9taW5hbnQtYmFzZWxpbmU6Y2VudHJhbCI+MzAweDIwMDwvdGV4dD48L3N2Zz4=";
        this.uploadId1Src = ko.observable();
        this.uploadId2Src = ko.observable();
        this.uploadId3Src = ko.observable();
        this.maxSize = 4194304;
        this.idFrontImage = this.makeField().extend({
          validation: {
            validator: (function(_this) {
              return function(val) {
                var element, file;
                element = $('input#' + _this.uploadId1FieldId())[0];
                if (element) {
                  file = element ? element.files[0] : void 0;
                  if (file) {
                    return file && (file.size <= _this.maxSize);
                  } else {
                    return true;
                  }
                } else {
                  return true;
                }
              };
            })(this),
            message: 'Maximum file size is 4Mb.'
          }
        });
        this.idBackImage = this.makeField().extend({
          validation: {
            validator: (function(_this) {
              return function(val) {
                var element, file;
                element = $('input#' + _this.uploadId2FieldId())[0];
                if (element) {
                  file = element ? element.files[0] : void 0;
                  if (file) {
                    return file && (file.size <= _this.maxSize);
                  } else {
                    return true;
                  }
                } else {
                  return true;
                }
              };
            })(this),
            message: 'Maximum file size is 4Mb.'
          }
        });
        this.atmCardImage = this.makeField().extend({
          validation: {
            validator: (function(_this) {
              return function(val) {
                var element, file;
                element = $('input#' + _this.uploadId3FieldId())[0];
                if (element) {
                  file = element ? element.files[0] : void 0;
                  if (file) {
                    return file && (file.size <= _this.maxSize);
                  } else {
                    return true;
                  }
                } else {
                  return true;
                }
              };
            })(this),
            message: 'Maximum file size is 4Mb.'
          }
        });
        this.file1Src = ko.computed((function(_this) {
          return function() {
            return _this.idFrontImage() || _this.uploadId1Src();
          };
        })(this));
        this.file1Src.extend({
          required: true,
          validation: {
            validator: (function(_this) {
              return function(val) {
                return val;
              };
            })(this),
            message: 'ID Front required',
            params: true
          }
        });
        this.file2Src = ko.computed((function(_this) {
          return function() {
            return _this.idBackImage() || _this.uploadId2Src();
          };
        })(this));
        this.file2Src.extend({
          required: true,
          validation: {
            validator: (function(_this) {
              return function(val) {
                return val;
              };
            })(this),
            message: 'ID Back required',
            params: true
          }
        });
        this.file3Src = ko.computed((function(_this) {
          return function() {
            return _this.atmCardImage() || _this.uploadId3Src();
          };
        })(this));
        this.file3Src.extend({
          required: true,
          validation: {
            validator: (function(_this) {
              return function(val) {
                return val;
              };
            })(this),
            message: 'ATM card required',
            params: true
          }
        });
        this.licensees = this.makeSelect();
        this.brands = this.makeSelect();
        this.currencies = this.makeSelect();
        this.arr = ko.observableArray();
        $.ajax("BankAccounts/GetBankAccountTypes").done((function(_this) {
          return function(data) {
            _this.bankAccountAccountTypes(data.bankAccountTypes);
            return _this.bankAccountAccountTypeId(bankAccount.bankAccountAccountTypeId);
          };
        })(this));
        $.ajax("/Licensee/Licensees?useFilter=false").done((function(_this) {
          return function(response) {
            var self;
            _this.licensees(response.licensees);
            _this.licenseeId(bankAccount.licenseeId);
            return $.ajax({
              url: config.adminApi("Brand/Brands?useFilter=false&licensees=" + bankAccount.licenseeId),
              context: _this
            }, self = _this).done(function(response) {
              _this.brands(response.brands);
              _this.brandId(bankAccount.brandId);
              $.get("BankAccounts/GetBanks?brandId=" + bankAccount.brandId).done(function(response) {
                self.banks(response.banks);
                return self.bankId(bankAccount.bankId);
              });
              return $.ajax({
                url: config.adminApi("BrandCurrency/GetBrandCurrenciesWithNames?brandId=" + bankAccount.brandId),
                context: _this
              }).done(function(response) {
                this.currencies(response.currencyCodes);
                this.currencyCode(bankAccount.currencyCode);
                this.licenseeId.subscribe((function(_this) {
                  return function(licenseeId) {
                    _this.licenseeId(licenseeId);
                    return $.ajax({
                      url: config.adminApi("Brand/Brands?useFilter=false&licensees=" + licenseeId),
                      context: _this
                    }).done(function(response) {
                      return this.brands(response.brands);
                    });
                  };
                })(this));
                return this.brandId.subscribe((function(_this) {
                  return function(brandId) {
                    _this.brandId(brandId);
                    $.ajax({
                      url: config.adminApi("BrandCurrency/GetBrandCurrenciesWithNames?brandId=" + brandId),
                      context: _this
                    }).done(function(response) {
                      return this.currencies(response.currencyCodes);
                    });
                    return $.get("BankAccounts/GetBanks?brandId=" + brandId).done(function(response) {
                      return self.banks(response.banks);
                    });
                  };
                })(this));
              });
            });
          };
        })(this));
      }

      EditBankAccountModel.prototype.makeFileInputSettings = function(resetOb) {
        return {
          style: 'well',
          btn_choose: "Drop image or click to choose",
          no_file: 'No File ...',
          droppable: true,
          thumbnail: 'fit',
          before_change: function(files, dropped) {
            var file, type;
            file = files[0];
            if (typeof file === "string") {
              if (!/\.(jpe?g|png|gif)$/i.test(file)) {
                -1;
              }
            } else {
              type = $.trim(file.type);
              if ((type.length > 0 && !/^image\/(jpe?g|png|gif)$/i.test(type)) || (type.length === 0 && !/\.(jpe?g|png|gif)$/i.test(file.name))) {
                -1;
              }
            }
            return true;
          },
          after_change: function(files, dropped) {
            alert(files);
            alert(dropped);
            return true;
          },
          before_remove: function() {
            resetOb('');
            return true;
          }
        };
      };

      EditBankAccountModel.prototype.mapto = function() {
        var ignoreFields;
        ignoreFields = ["licensees", "licenseeId", "brands", "currencies", "bankAccountAccountTypes"];
        return EditBankAccountModel.__super__.mapto.call(this, ignoreFields);
      };

      return EditBankAccountModel;

    })(baseModel);
  });

}).call(this);
