(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}},t={}.hasOwnProperty,i=function(n,i){function u(){this.constructor=n}for(var r in i)t.call(i,r)&&(n[r]=i[r]);return u.prototype=i.prototype,n.prototype=new u,n.__super__=i.prototype,n};define(function(t){var f,e,r,u,o;return u=t("nav"),r=t("i18next"),o=t("dateTimePicker"),f=t("base/base-view-model"),e=t("payments/bank-accounts/models/edit-bank-account-model"),function(t){function f(){this.activate=n(this.activate,this);f.__super__.constructor.apply(this,arguments);this.SavePath="/BankAccounts/SaveChanges";this.submitted(!1);this.message=ko.observable();this.messageClass=ko.observable();this.tmp=ko.observable()}return i(f,t),f.prototype.handleSaveFailure=function(n){var e,u,t,i,o,f;if(t=n!=null?n.fields:void 0,t!=null){for(f=[],i=0,o=t.length;i<o;i++)u=t[i],e=u.errors[0],f.push(this.setError(this.Model[u.name],r.t("app:banks.validation."+e)));return f}},f.prototype.save=function(){var t,n;return this.clearMessage(),this.Model.validate()?(t={id:this.Model.id(),bank:this.Model.bankId(),brandId:this.Model.brandId(),licenseeId:this.Model.licenseeId(),currency:this.Model.currencyCode(),accountId:this.Model.bankAccountId(),accountName:this.Model.bankAccountName(),accountNumber:this.Model.bankAccountNumber(),accountType:this.Model.bankAccountAccountTypeId(),province:this.Model.bankAccountProvince(),branch:this.Model.bankAccountBranch(),remarks:this.Model.remarks(),supplierName:this.Model.supplierName(),contactNumber:this.Model.contactNumber(),uSBCode:this.Model.usbCode(),purchasedDate:this.Model.purchasedDate(),utilizationDate:this.Model.utilizationDate(),expirationDate:this.Model.expirationDate(),uploadId1Src:this.Model.uploadId1Src(),uploadId2Src:this.Model.uploadId2Src(),uploadId3Src:this.Model.uploadId3Src()},n=new FormData,n.append("uploadId1",$("input#"+this.Model.uploadId1FieldId())[0].files[0]),n.append("uploadId2",$("input#"+this.Model.uploadId2FieldId())[0].files[0]),n.append("uploadId3",$("input#"+this.Model.uploadId3FieldId())[0].files[0]),n.append("bankAccount",JSON.stringify(t)),$.ajax({type:"POST",url:this.SavePath,data:n,processData:!1,contentType:!1,xhr:function(n){return function(){var t;return t=new XMLHttpRequest,t.onreadystatechange=function(){var i;if(4===t.readyState)return i=JSON.parse(t.responseText),i.result==="failed"?n.showError(i.data):(u.close(),u.open({path:"payments/bank-accounts/view",title:r.t("app:banks.viewAccount"),key:i.data.id,data:{id:i.data.id,message:r.t("app:bankAccounts.updated")}}),$("#bank-accounts-list").trigger("reloadGrid")),i.data.idFrontImage&&n.Model.uploadId1Src("image/Show?fileId="+i.data.idFrontImage+"&playerId="+n.Model.id()),i.data.idBackImage&&n.Model.uploadId2Src("image/Show?fileId="+i.data.idBackImage+"&playerId="+n.Model.id()),i.data.atmCardImage&&n.Model.uploadId3Src("image/Show?fileId="+i.data.atmCardImage+"&playerId="+n.Model.id()),n.showMessage("Updated successfully."),n.submitted(!0)},t}}(this)})):this.showError(r.t("app:bankAccounts.notValid"))},f.prototype.activate=function(n){return f.__super__.activate.apply(this,arguments),$.get("/BankAccounts/Edit?id="+n.id).done(function(n){return function(t){return n.Model=new e(t),t.idFrontImage&&n.Model.uploadId1Src("image/Show?fileId="+t.idFrontImage+"&playerId="+n.Model.id()),t.idBackImage&&n.Model.uploadId2Src("image/Show?fileId="+t.idBackImage+"&playerId="+n.Model.id()),t.atmCardImage?n.Model.uploadId3Src("image/Show?fileId="+t.atmCardImage+"&playerId="+n.Model.id()):void 0}}(this))},f.prototype.compositionComplete=function(){return $("input#"+this.Model.uploadId1FieldId()).ace_file_input(this.Model.makeFileInputSettings(this.Model.idFrontImage)),$("input#"+this.Model.uploadId2FieldId()).ace_file_input(this.Model.makeFileInputSettings(this.Model.idBackImage)),$("input#"+this.Model.uploadId3FieldId()).ace_file_input(this.Model.makeFileInputSettings(this.Model.atmCardImage))},f.prototype.showError=function(n){return this.message(n),this.messageClass("alert alert-danger")},f.prototype.showMessage=function(n){return this.message(n),this.messageClass("alert alert-success")},f.prototype.clearMessage=function(){return this.message(""),this.messageClass("")},f.prototype.cancel=function(){return u.close()},f}(f)})}).call(this);