(function(){var n={}.hasOwnProperty,t=function(t,i){function u(){this.constructor=t}for(var r in i)n.call(i,r)&&(t[r]=i[r]);return u.prototype=i.prototype,t.prototype=new u,t.__super__=i.prototype,t};define(function(n){var e,o,r,f,u,i,s;return n("controls/grid"),r=n("i18next"),o=n("durandal/app"),i=n("security/security"),s=n("shell"),u=n("nav"),f=n("currency-manager/status-dialog"),e=n("controls/filters"),function(e){function o(){this.moment=n("moment");this.id=ko.observable();this.name=ko.observable();this.status=ko.observable();this.isBaseCurrency=ko.observable();this.licenseeNames=ko.observableArray();this.brandNames=ko.observableArray();this.currentLicensee=ko.observable();this.currentBrand=ko.observable();$.get("CurrencyExchange/GetLicenseeNames").done(function(n){return function(t){var u,i,f,r;for(n.currentLicensee(t[0].Name),r=[],i=0,f=t.length;i<f;i++)u=t[i],r.push(n.licenseeNames.push(u.Name));return r}}(this));$.get("CurrencyExchange/GetBrandNames").done(function(n){return function(t){var u,i,f,r;for(n.currentBrand(t[0].Name),r=[],i=0,f=t.length;i<f;i++)u=t[i],r.push(n.brandNames.push(u.Name));return r}}(this));console.log("currentLicensee "+this.currentLicensee());console.log("currentBrand "+this.currentBrand());this.columns=ko.observableArray();this.columns([["Brand.LicenseeName","Licensee Name","list",this.licenseeNames()],["Brand.Name","Brand Name","list",this.brandNames()],["CurrencyTo.Code","Currency Code","text"],["CurrencyTo.Name","Currency Name","text"],["CurrentRate","Exchange Rate","numeric"],["IsBaseCurrency","Base Currency","bool"]]);this.filterVisible=ko.observable(!0);this.filterInvisible=ko.computed(function(n){return function(){return!n.filterVisible()}}(this));this.baseFilter=ko.observable();this.defaultPaging={options:[10,30,50,100]};this.compositionComplete=function(n){return function(){return $(n.grid).trigger("reload"),$(".ui-jqgrid",n.grid).css({visibility:"visible"})}}(this);this.gridFields=ko.computed(function(n){return function(){return n.columns().map(function(n){return n[0]})}}(this));this.filterColumns=ko.computed(function(n){return function(){return n.columns().filter(function(n){return n[0]})}}(this));this.filtersCriteria=ko.computed(function(n){return function(){var i,t,r;return r=n.currentLicensee(),i=n.currentBrand(),t={},r!=null&&(t["Brand.LicenseeName"]=r),i!=null&&(t["Brand.Name"]=i),t}}(this));this.attached=function(n){return function(t){var i,r;(i=findGrid(t)).on("gridLoad selectionChange",function(t,i){return n.id(i.id),n.name(i.data.Name),n.status(i.data.Status),n.isBaseCurrency(i.data.IsBaseCurrency==="Yes")});return n.grid=i[0],$(".ui-jqgrid",n.grid).css({visibility:"hidden"}),(r=$("form",n.grid)).submit(function(){return setTimeout(function(){return $(n.grid).trigger("reload"),$(".ui-jqgrid",n.grid).css({visibility:"visible"})}),!1})}}(this)}return t(o,e),o.prototype.showFilter=function(){return this.filterVisible(!0),$(window).resize()},o.prototype.hideFilter=function(){return this.filterVisible(!1),$(window).resize()},o.prototype.isViewAllowed=ko.computed(function(){return i.isOperationAllowed(i.permissions.view,i.categories.exchangeRateManager)}),o.prototype.isAddAllowed=ko.computed(function(){return i.isOperationAllowed(i.permissions.create,i.categories.exchangeRateManager)}),o.prototype.isEditAllowed=ko.computed(function(){return i.isOperationAllowed(i.permissions.update,i.categories.exchangeRateManager)}),o.prototype.openAddTab=function(){return u.open({path:"brand/currencyexchange-manager/add-currencyexchange",title:ko.observable(r.t("app:currencies.newRate"))})},o.prototype.openEditTab=function(){if(this.id)return u.open({path:"brand/currencyexchange-manager/edit-currencyexchange",title:ko.observable(r.t("app:currencies.setRate")),data:{id:this.id()}})},o.prototype.openViewTab=function(){if(this.id)return u.open({path:"brand/currencyexchange-manager/view-currencyexchange",title:ko.observable(r.t("app:currencies.viewRate")),data:{id:this.id()}})},o.prototype.showDialog=function(){return console.log(this.grid),f.show(this.id(),this.status(),this.grid)},o}(n("vmGrid"))})}).call(this);