(function(){var n={}.hasOwnProperty,t=function(t,i){function u(){this.constructor=t}for(var r in i)n.call(i,r)&&(t[r]=i[r]);return u.prototype=i.prototype,t.prototype=new u,t.__super__=i.prototype,t},i=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1};define(function(n){var e,f,u,r,o;return o=n("komapping"),r=n("i18next"),e=n("controls/assign"),f=n("base/base-model"),u=n("config"),n("utils"),function(f){function e(){var t;e.__super__.constructor.apply(this,arguments);this.code=this.makeField().extend({required:!0,minLength:1,maxLength:12}).extend({pattern:{message:r.t("admin.messages.roleCodeInvalid"),params:"^[A-Za-z0-9]+(?:[._'-][A-Za-z0-9]+)*$"}});this.name=this.makeField().extend({required:!0,minLength:1,maxLength:20}).extend({pattern:{message:r.t("admin.messages.roleNameInvalid"),params:"^[A-Za-z0-9]+(?:[._'-][A-Za-z0-9]+)*$"}});this.description=this.makeField();this.roles=ko.observableArray();this.roleId=this.makeField();this.roleId.subscribe(function(n){return function(t){if(t!=null)return $.get(u.adminApi("RoleManager/GetRole"),{id:t}).done(function(t){return n.checkedPermissions(t.checkedPermissions)})}}(this));this.licensees=ko.observableArray();this.assignedLicensees=this.makeArrayField().extend({validation:{validator:function(){return function(n){return(n!=null?n.length:void 0)>0}}(this),message:r.t("admin.messages.licenseesRequired"),params:!0}});this.displayLicensees=ko.observable();this.assignedLicensees.subscribe(function(n){return function(t){if(t!=null)return $.ajax({type:"POST",url:u.adminApi("RoleManager/GetLicenseeData"),data:ko.toJSON(t),dataType:"json",contentType:"application/json"}).done(function(t){return n.roles(t.roles)})}}(this));this.checkedPermissions=ko.observableArray();t=n("security/security");this.isLicenseeLocked=ko.computed(function(){return function(){return t.licensees()!=null&&t.licensees().length>0&&!t.isSuperAdmin()}}(this));this.selectedModules=ko.computed({read:function(n){return function(){var r;return r=t.operations().filter(function(t){var r;return r=t.id,i.call(n.checkedPermissions(),r)>=0}),r.unique(function(n){return n.module}).map(function(n){return{id:Math.random(),name:n.module,permissions:r.filter(function(t){return t.module===n.module}).map(function(n){return n.name}).join("\n")}})}}(this)})}return t(e,f),e}(f)})}).call(this);