(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}},t={}.hasOwnProperty,i=function(n,i){function u(){this.constructor=n}for(var r in i)t.call(i,r)&&(n[r]=i[r]);return u.prototype=i.prototype,n.prototype=new u,n.__super__=i.prototype,n};define(function(t){var s,e,o,u,f,r;return u=t("i18next"),o=t("durandal/app"),f=t("security/security"),r=t("shell"),e=t("controls/filters"),s=t("controls/column-selection-dialog"),function(s){function h(i,u,o){var s;this.reportGroup=i;this.reportName=u;this.columns=o;this.setColumnListItems=n(this.setColumnListItems,this);h.__super__.constructor.apply(this,arguments);this.filters=new e;this.moment=t("moment");this.id=ko.observable();this.columns=ko.observableArray(function(){var n,r,t,i;for(t=ko.unwrap(this.columns),i=[],n=0,r=t.length;n<r;n++)s=t[n],i.push([s[0],this.columnTitle(s[0]),s[1],s[2]]);return i}.call(this));this.setColumnListItems("Licensee",r.licensees().filter(function(n){return n.id()!=null}).map(function(n){return n.name()}));this.setColumnListItems("Brand",r.brands().filter(function(n){return n.id()!=null}).map(function(n){return n.name()}));this.exportAllowed=ko.observable(f.isOperationAllowed(f.permissions["export"],f.categories[this.reportName+"Report"]));this.exportEnabled=ko.observable(!1);this.currentLicensee=ko.computed(function(){return function(){return r.licensee().id()!=null?r.licensee().name():null}}(this));this.currentBrand=ko.computed(function(){return function(){return r.brand().id()!=null?r.brand().name():null}}(this));this.filterColumns=ko.computed(function(n){return function(){return n.columns().filter(function(n){return n[2]!=null})}}(this));this.gridFields=ko.computed(function(n){return function(){return n.columns().map(function(n){return n[0]})}}(this));this.defaultPaging={options:[10,30,50,100]};this.noRecordsFound=ko.observable(!1);this.filtersCriteria=ko.computed(function(n){return function(){var i,t,r;return r=n.currentLicensee(),i=n.currentBrand(),t={},r!=null&&(t.Licensee=r),i!=null&&(t.Brand=i),t}}(this));this.attached=function(n){return function(t){var i,f,r,u,o,e;(i=findGrid(t)).on("selectionChange",function(t,i){return n.id(i.id)});n.grid=i[0];i.on("gridLoad",function(t,r){return n.id(r.id),n.noRecordsFound(n.grid.gridParam("reccount")===0),$(".ui-jqgrid",i).toggle(!n.noRecordsFound()),n.exportEnabled(!n.noRecordsFound())});for(e=n.columns(),u=0,o=e.length;u<o;u++)f=e[u],n.grid.setColumnTitle(f[0],f[1]);(r=$("form",n.grid)).submit(function(){return setTimeout(function(){return $(n.grid).trigger("reload")},100),!1});n.onBrandChange=function(){return r.submit()};$(document).on("change_brand",n.onBrandChange);return n.currentBrand()!=null||n.currentLicensee()!=null?function(){var t,i;if((((t=n.grid.filters)!=null?(i=t.criteria())!=null?i.length:void 0:void 0)||0)<=1){setTimeout(arguments.callee,100);return}return r.submit()}():r.submit()}}(this);this.detached=function(n){return function(){return $(document).off("change_brand",n.onBrandChange)}}(this)}return i(h,s),h.prototype.columnTitle=function(n){return u.t("report."+this.reportGroup+"Reports."+this.reportName+".columns."+n)},h.prototype.setColumnListItems=function(n,t){var i;return i=ko.utils.arrayFirst(this.columns(),function(t){return t[0]===n}),i!=null?i[3]=t:void 0},h.prototype.exportReport=function(){return o.showMessage(u.t("app:report.common.export")+" "+u.t("app:report."+this.reportGroup+"Reports."+this.reportName+".reportName")+"?",u.t("app:report.messages.confirmExport"),[{text:u.t("common.booleanToYesNo.true"),value:!0},{text:u.t("common.booleanToYesNo.false"),value:!1}],!1,{style:{width:"350px"}}).then(function(n){return function(t){var f,e,i,u,s,o;if(t){for(i=[],r.brand().id()!=null&&i.push("brand="+r.brand().name()),o=n.grid.filters.toJqGridFilters().rules,u=0,s=o.length;u<s;u++)f=o[u],i.push(f.field+"="+f.data);return i.push("sortColumnName="+n.grid.gridParam("sortname")),i.push("sortOrder="+n.grid.gridParam("sortorder")),e=localStorage.getItem(n.columnStorage),e!=null&&i.push("hiddenColumns="+JSON.parse(e).join(",")),document.location="/report/export"+n.reportName+"Report?"+i.join("&")}}}(this))},h}(t("vmGrid"))})}).call(this);